#!/bin/bash
# ==============================================
# ğŸš€ AI-Trader DeepSeek ä¸€é”®å¯åŠ¨è„šæœ¬
# ==============================================

# åœæ­¢è„šæœ¬æ—¶é€€å‡ºæ‰€æœ‰åå°è¿›ç¨‹
trap 'kill $(jobs -p) 2>/dev/null' EXIT

echo "ğŸ” æ£€æŸ¥ Python ç¯å¢ƒ..."
if ! command -v python3 &>/dev/null; then
  echo "âŒ æœªæ£€æµ‹åˆ° python3ï¼Œè¯·å…ˆå®‰è£…ï¼šbrew install python"
  exit 1
fi

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
if [ -d "venv" ]; then
  echo "âœ… æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ..."
  source venv/bin/activate
else
  echo "âŒ æœªæ‰¾åˆ°è™šæ‹Ÿç¯å¢ƒï¼Œè¯·å…ˆè¿è¡Œï¼špython3 -m venv venv && source venv/bin/activate"
  exit 1
fi

# æ£€æŸ¥ .env æ–‡ä»¶
if [ ! -f ".env" ]; then
  echo "âŒ æœªæ£€æµ‹åˆ° .env æ–‡ä»¶ï¼Œè¯·å…ˆåˆ›å»ºå¹¶å¡«å†™ API Key"
  exit 1
fi

# å¯åŠ¨ MCP å·¥å…·é“¾
echo "âš™ï¸ å¯åŠ¨ MCP å·¥å…·é“¾..."
cd agent_tools || exit
nohup python start_mcp_services.py > ../logs_mcp.txt 2>&1 &
cd ..

# ç­‰å¾… 3 ç§’ä»¥ç¡®ä¿å·¥å…·é“¾å¯åŠ¨
sleep 3

# å¯åŠ¨ DeepSeek æ¯”èµ›
echo "ğŸ¤– å¯åŠ¨ DeepSeek AI-Trader æ¯”èµ›..."
python main.py configs/deepseek.json | tee logs_run.txt

# å¯åŠ¨æœ¬åœ°ç½‘é¡µæœåŠ¡
echo "ğŸŒ å¯åŠ¨æœ¬åœ°æ’è¡Œæ¦œç•Œé¢..."
cd docs || exit
python3 -m http.server 8000 &
sleep 2
open "http://localhost:8000"
cd ..

echo "âœ… ä¸€åˆ‡å°±ç»ªï¼DeepSeek æ¨¡å‹æ­£åœ¨äº¤æ˜“..."

