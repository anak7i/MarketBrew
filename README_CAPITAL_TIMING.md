# AlphaBloom 资金流向择时模块

## 📊 功能介绍

资金流向择时模块是AlphaBloom的核心择时功能，通过整合多维度资金流向数据，为投资者提供全面的市场择时分析。

### 主要功能

1. **北向资金流向** - 沪深港通北向资金的实时流入流出分析
2. **ETF资金流** - 主要ETF产品的资金流向追踪
3. **主力资金** - 沪深300成分股的主力资金流向监控
4. **多周期统计** - 1日、3日、7日、14日、28日的流入流出统计
5. **择时信号** - 基于资金流向的综合择时信号和投资建议

## 🚀 快速开始

### 方式一：使用批处理文件（推荐）

1. 双击运行 `start_capital_timing.bat`
2. 等待服务启动（约5-10秒）
3. 在浏览器中打开 `capital_timing.html`

### 方式二：手动启动

```bash
# 1. 启动API服务
python capital_timing_api.py

# 2. 在浏览器中打开
capital_timing.html
```

## 📡 API接口文档

### 基础信息

- **服务地址**: http://localhost:5001
- **数据来源**: 东方财富网API (免费、无需账号)
- **更新频率**: 实时（带5分钟缓存）

### 主要接口

#### 1. 获取综合择时数据
```
GET /api/timing/comprehensive
```

返回完整的择时数据，包括：
- 北向资金流向和多周期统计
- ETF资金流向和多周期统计
- 主力资金流向和多周期统计
- 综合择时信号和建议

#### 2. 获取北向资金数据
```
GET /api/timing/north-bound?days=30
```

参数：
- `days`: 获取天数（默认30天）

#### 3. 获取ETF资金流数据
```
GET /api/timing/etf-flow?days=30
```

参数：
- `days`: 获取天数（默认30天）

#### 4. 获取主力资金数据
```
GET /api/timing/main-force?days=30
```

参数：
- `days`: 获取天数（默认30天）

#### 5. 获取择时信号
```
GET /api/timing/signal
```

返回当前的择时信号和投资建议。

#### 6. 清空缓存
```
POST /api/timing/clear-cache
```

清空所有数据缓存，强制重新获取数据。

## 📈 数据说明

### 北向资金

- **数据来源**: 沪深港通实时数据
- **更新时间**: 交易日9:30-16:00实时更新
- **统计口径**:
  - 沪股通 + 深股通的净流入
  - 正值表示净流入，负值表示净流出

### ETF资金流

- **覆盖ETF**:
  - 510300 (沪深300ETF)
  - 510500 (中证500ETF)
  - 159915 (创业板ETF)
  - 588000 (科创50ETF)
  - 512880 (证券ETF)
- **统计口径**: 主力资金净流入

### 主力资金

- **统计范围**: 沪深300成分股
- **分类**:
  - 超大单：单笔>=100万元
  - 大单：单笔50-100万元
  - 中单：单笔10-50万元
  - 小单：单笔<10万元

## 🎯 择时信号解读

### 信号级别

1. **强烈看多** (strong_bullish)
   - 综合评分 >= 3
   - 多项资金指标同时向好
   - 建议：积极参与

2. **偏多** (bullish)
   - 综合评分 >= 1
   - 部分资金指标向好
   - 建议：适度参与

3. **中性观望** (neutral)
   - 综合评分 = 0
   - 资金流向分化
   - 建议：保持观望

4. **偏空** (bearish)
   - 综合评分 <= -1
   - 部分资金指标转弱
   - 建议：谨慎操作

5. **强烈看空** (strong_bearish)
   - 综合评分 <= -3
   - 多项资金指标同时转弱
   - 建议：规避风险

### 信号生成逻辑

```
评分规则：
1. 北向资金3日净流入 > 50亿: +2分
2. 北向资金3日净流出 > 50亿: -2分
3. ETF资金7日净流入 > 20亿: +1分
4. ETF资金7日净流出 > 20亿: -1分
5. 主力资金今日净流入 > 100亿: +1分
6. 主力资金今日净流出 > 100亿: -1分
```

## 📁 文件结构

```
marketbrew/
├── capital_flow_timing_service.py   # 资金流向数据服务
├── capital_timing_api.py            # Flask API服务
├── capital_timing.html              # 前端展示页面
├── start_capital_timing.bat         # Windows启动脚本
├── eastmoney_data_service.py        # 东方财富数据服务（依赖）
└── README_CAPITAL_TIMING.md         # 本文档
```

## 🔧 技术栈

### 后端
- **Python 3.x**
- **Flask** - Web框架
- **Flask-CORS** - 跨域支持
- **Requests** - HTTP客户端

### 前端
- **HTML5 + CSS3 + JavaScript**
- **Chart.js** - 图表库
- **Fetch API** - 数据请求

## 💡 使用建议

### 1. 数据更新频率
- 交易时间内：建议每5-10分钟刷新一次
- 非交易时间：每日盘后查看即可

### 2. 择时策略
- **短线**：关注1日和3日数据
- **中线**：关注7日和14日数据
- **长线**：关注14日和28日数据

### 3. 综合研判
- 不要单独依赖某一项指标
- 结合多周期数据综合分析
- 配合其他技术指标使用

## ⚠️ 注意事项

1. **数据延迟**
   - 数据有5分钟缓存，不是绝对实时
   - 盘中数据可能有1-2分钟延迟

2. **仅供参考**
   - 择时信号仅供参考，不构成投资建议
   - 投资有风险，决策需谨慎

3. **网络要求**
   - 需要能访问东方财富网API
   - 建议使用稳定的网络连接

## 🐛 故障排除

### 问题1：服务启动失败

**原因**: Python环境问题或依赖包未安装

**解决方案**:
```bash
# 安装依赖
pip install flask flask-cors requests

# 或使用项目的requirements.txt
pip install -r requirements.txt
```

### 问题2：前端无法加载数据

**原因1**: API服务未启动
- 确保 `capital_timing_api.py` 正在运行

**原因2**: 端口被占用
- 修改 `capital_timing_api.py` 中的端口号
- 同时修改 `capital_timing.html` 中的 API_BASE 地址

### 问题3：数据获取失败

**原因**: 网络问题或API限流

**解决方案**:
1. 检查网络连接
2. 点击"清空缓存"按钮重试
3. 稍后再试（可能是API限流）

## 📞 技术支持

如遇问题，请检查：
1. Python版本是否 >= 3.7
2. 依赖包是否正确安装
3. 网络连接是否正常
4. 端口5001是否被占用

## 📝 更新日志

### v1.0 (2025-11-28)
- ✅ 初始版本发布
- ✅ 集成北向资金、ETF资金、主力资金数据
- ✅ 实现1/3/7/14/28日多周期统计
- ✅ 实现择时信号生成
- ✅ 完成前端可视化界面
- ✅ 使用东方财富免费API（无需账号）

## 🎉 特别说明

本模块完全使用东方财富公开API，**无需账号**、**完全免费**、**数据准确**！

相比EMT API：
- ❌ EMT API需要券商账号和权限申请
- ✅ 本模块直接可用，零门槛
- ✅ 数据来源相同，准确性一致
- ✅ 更适合个人投资者使用

---

**MarketBrew & AlphaBloom** - 让投资更智能
