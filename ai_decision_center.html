<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaBloom - 智能股票分析系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #00d4aa;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            
            --bg-primary: #0f1419;
            --bg-secondary: #1a202c;
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-glass: rgba(255, 255, 255, 0.1);
            
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --text-light: #ffffff;
            
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --border-radius-xl: 24px;
            
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.25);
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0.1;
            z-index: -1;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
        }

        /* 头部区域 */
        .header {
            background: var(--bg-card);
            padding: 40px;
            border-radius: var(--border-radius-xl);
            margin-bottom: 32px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .header h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3.5rem;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.02em;
            position: relative;
        }
        
        .header h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--success-gradient);
            border-radius: 2px;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1.25rem;
            margin-bottom: 24px;
            font-weight: 500;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .system-status {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--success-gradient);
            color: var(--text-light);
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        .system-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: var(--shadow-md), 0 0 20px rgba(0, 212, 170, 0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: var(--shadow-lg), 0 0 30px rgba(0, 212, 170, 0.5);
            }
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* 控制区域 */
        .control-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .analysis-control {
            background: var(--bg-card);
            padding: 32px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .analysis-control::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
        }

        .analysis-control h2 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .analysis-control h2 i {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.5rem;
        }

        .analysis-info {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            padding: 24px;
            border-radius: var(--border-radius-md);
            margin-bottom: 24px;
            border: none;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }
        
        .analysis-info::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary-gradient);
        }

        .analysis-info .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-size: 1rem;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .analysis-info .status-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .analysis-info .status-item span {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .analysis-info .status-item strong {
            color: var(--text-primary);
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-button {
            width: 100%;
            background: var(--success-gradient);
            color: var(--text-light);
            border: none;
            padding: 18px 32px;
            border-radius: var(--border-radius-md);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            margin-bottom: 16px;
        }
        
        .main-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .main-button:hover::before {
            left: 100%;
        }

        .main-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .main-button:active {
            transform: translateY(-1px) scale(1.01);
        }

        .main-button:disabled {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }
        
        .main-button.secondary {
            background: var(--dark-gradient);
        }
        
        .main-button i {
            margin-right: 8px;
        }

        .quick-stats {
            background: var(--bg-card);
            padding: 32px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .quick-stats::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--success-gradient);
        }
        
        .quick-stats h2 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .quick-stats h2 i {
            background: var(--success-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 24px 16px;
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-number {
            font-size: 2.25rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* 决策区域 */
        .decision-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .decision-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            transition: var(--transition);
            position: relative;
        }
        
        .decision-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .decision-header {
            padding: 24px 32px;
            color: var(--text-light);
            text-align: center;
            font-weight: 700;
            font-size: 1.3rem;
            position: relative;
            overflow: hidden;
        }
        
        .decision-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }
        
        .decision-header i {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .buy-header { background: var(--success-gradient); }
        .sell-header { background: var(--danger-gradient); }
        .hold-header { background: var(--dark-gradient); }

        .decision-content {
            padding: 24px 32px;
            max-height: 450px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
        }
        
        .decision-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .decision-content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .decision-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .decision-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .stock-item {
            padding: 20px;
            margin-bottom: 16px;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: var(--border-radius-md);
            border: none;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .stock-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            transition: var(--transition);
        }

        .stock-item:hover {
            transform: translateY(-2px) translateX(4px);
            box-shadow: var(--shadow-md);
        }
        
        .stock-item:hover::before {
            width: 6px;
        }

        .stock-item.buy::before { background: var(--success-gradient); }
        .stock-item.sell::before { background: var(--danger-gradient); }
        .stock-item.hold::before { background: var(--dark-gradient); }

        .stock-code {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .stock-reason {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .stock-price {
            font-size: 1rem;
            font-weight: 600;
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            background: rgba(0, 0, 0, 0.05);
        }
        
        .stock-item:last-child {
            margin-bottom: 0;
        }

        /* 市场概况 */
        .market-overview {
            background: var(--bg-card);
            padding: 32px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .market-overview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--warning-gradient);
        }

        .market-overview h2 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .market-overview h2 i {
            background: var(--warning-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .market-summary {
            background: var(--info-color);
            background: var(--dark-gradient);
            color: var(--text-light);
            padding: 28px;
            border-radius: var(--border-radius-md);
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .market-summary::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .market-summary h3 {
            margin-bottom: 16px;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .market-summary h3 i {
            font-size: 1.2em;
        }

        .market-text {
            line-height: 1.7;
            opacity: 0.95;
            font-size: 1.05rem;
        }

        .risk-alerts {
            background: linear-gradient(145deg, #fef3c7, #fde68a);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: var(--border-radius-md);
            padding: 24px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
            position: relative;
        }
        
        .risk-alerts::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--warning-gradient);
            border-radius: 2px 0 0 2px;
        }

        .risk-alerts h4 {
            color: #92400e;
            margin-bottom: 16px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .risk-alerts h4 i {
            color: #f59e0b;
        }

        .risk-alerts ul {
            color: #92400e;
            padding-left: 24px;
            line-height: 1.6;
        }
        
        .risk-alerts li {
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .risk-alerts li:last-child {
            margin-bottom: 0;
        }

        /* 响应式设计 */
        @media (max-width: 1400px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 3rem;
            }
        }
        
        @media (max-width: 1200px) {
            .control-section {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .decision-section {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .header {
                padding: 32px 24px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .header {
                padding: 24px 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header .subtitle {
                font-size: 1.1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .analysis-control,
            .quick-stats,
            .market-overview {
                padding: 24px;
            }
            
            .decision-content {
                padding: 20px 24px;
            }
            
            .system-status {
                padding: 12px 24px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            .analysis-control,
            .quick-stats,
            .market-overview {
                padding: 20px;
            }
            
            .decision-header {
                padding: 20px;
                font-size: 1.1rem;
            }
            
            .decision-content {
                padding: 16px 20px;
            }
        }

        /* 通知系统 */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--success-gradient);
            color: var(--text-light);
            padding: 20px 28px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transform: translateX(120%);
            transition: var(--transition);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification::before {
            content: '\f058';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 1.2em;
        }

        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--danger-gradient);
        }
        
        .notification.error::before {
            content: '\f06a';
        }
        
        .notification.warning {
            background: var(--warning-gradient);
        }
        
        .notification.warning::before {
            content: '\f071';
        }
        
        .notification.info {
            background: var(--dark-gradient);
        }
        
        .notification.info::before {
            content: '\f05a';
        }

        /* 加载状态 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 新增动画效果 */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 进场信号面板样式 */
        .entry-signal-section {
            margin-bottom: 32px;
        }
        
        .entry-signal-panel {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .entry-signal-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
        }
        
        .entry-signal-panel h2 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .signal-dashboard {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 32px;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .overall-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--danger-color), var(--warning-color), var(--success-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: var(--text-light);
            position: relative;
            box-shadow: var(--shadow-md);
        }
        
        .score-circle::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: var(--bg-secondary);
            border-radius: 50%;
            z-index: -1;
        }
        
        .score-circle small {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .signal-dimensions {
            display: flex;
            flex-direction: column;
            gap: 16px;
            flex: 1;
        }
        
        .dimension-item {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .dimension-label {
            min-width: 80px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .dimension-bar {
            flex: 1;
            height: 12px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }
        
        .dimension-fill {
            height: 100%;
            border-radius: 6px;
            transition: var(--transition);
            position: relative;
        }
        
        .dimension-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }
        
        .dimension-value {
            min-width: 40px;
            text-align: right;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .signal-recommendation {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-width: 200px;
        }
        
        .recommendation-badge {
            padding: 8px 16px;
            border-radius: var(--border-radius-lg);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
            animation: pulse 2s infinite;
        }
        
        .recommendation-badge.positive {
            background: var(--success-gradient);
            color: var(--text-light);
        }
        
        .recommendation-badge.neutral {
            background: var(--warning-gradient);
            color: var(--text-light);
        }
        
        .recommendation-badge.negative {
            background: var(--danger-gradient);
            color: var(--text-light);
        }
        
        .recommendation-badge.loading {
            background: var(--dark-gradient);
            color: var(--text-light);
        }
        
        .recommendation-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.4;
        }
        
        .position-size {
            display: flex;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .position-value {
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .signal-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
        }
        
        .signal-refresh-btn, .signal-history-btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius-lg);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .signal-refresh-btn {
            background: var(--primary-gradient);
            color: var(--text-light);
        }
        
        .signal-refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .signal-history-btn {
            background: var(--bg-glass);
            color: var(--text-primary);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .signal-history-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* 响应式设计 - 进场信号面板 */
        @media (max-width: 1200px) {
            .signal-dashboard {
                grid-template-columns: 1fr;
                gap: 24px;
                text-align: center;
            }
            
            .signal-recommendation {
                min-width: auto;
            }
        }
        
        @media (max-width: 768px) {
            .entry-signal-panel {
                padding: 24px;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
                font-size: 1.5rem;
            }
            
            .score-circle::before {
                width: 80px;
                height: 80px;
            }
            
            .signal-dimensions {
                gap: 12px;
            }
            
            .dimension-item {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .dimension-label {
                min-width: auto;
                text-align: center;
            }
            
            .signal-actions {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* 页面加载动画 */
        .container > * {
            animation: slideUp 0.8s ease-out;
        }
        
        .container > *:nth-child(1) { animation-delay: 0.1s; }
        .container > *:nth-child(2) { animation-delay: 0.2s; }
        .container > *:nth-child(3) { animation-delay: 0.3s; }
        .container > *:nth-child(4) { animation-delay: 0.4s; }
        .container > *:nth-child(5) { animation-delay: 0.5s; }
        
        /* 数据更新动画 */
        .updating {
            animation: pulse-update 1s ease-in-out;
        }
        
        @keyframes pulse-update {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Market Mood 新样式 */
        .mood-score-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        .mood-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #06b6d4 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            position: relative;
        }
        
        .mood-circle span {
            font-size: 2rem;
            line-height: 1;
        }
        
        .mood-circle small {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .mood-level {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .mood-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
        }
        
        .action-recommendation {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            padding: 24px;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .action-type {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-description {
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .confidence-level {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 8px;
            background: rgba(156, 163, 175, 0.2);
            border-radius: 4px;
            position: relative;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f97316, #eab308, #22c55e);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .confidence-text {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .mood-dimensions {
            margin: 32px 0;
        }
        
        .mood-dimensions h3 {
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .dimension-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-md);
            padding: 20px;
            border: 1px solid rgba(156, 163, 175, 0.1);
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .dimension-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .dimensions-explanation {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            padding: 16px 20px;
            border-radius: var(--border-radius-md);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .dimensions-explanation p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .dimension-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-weight: 600;
            position: relative;
        }
        
        .dimension-header i {
            color: var(--primary-color);
        }
        
        .tooltip-icon {
            color: var(--text-secondary) !important;
            font-size: 0.8rem !important;
            cursor: help;
            margin-left: auto;
        }
        
        .dimension-meaning {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .dimension-meaning small {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .custom-tooltip {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            max-width: 200px;
            line-height: 1.4;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.2s ease;
        }
        
        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .mood-help-section {
            margin-top: 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(156, 163, 175, 0.1);
            overflow: hidden;
        }
        
        .help-toggle {
            padding: 16px 20px;
            cursor: pointer;
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            border-bottom: 1px solid rgba(156, 163, 175, 0.1);
            transition: background 0.3s ease;
        }
        
        .help-toggle:hover {
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
        }
        
        .help-toggle h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.rotated {
            transform: rotate(180deg);
        }
        
        .help-content {
            padding: 20px;
        }
        
        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        
        .help-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 16px;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .help-card h5 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .help-card ul {
            margin: 0;
            padding-left: 16px;
            list-style: none;
        }
        
        .help-card li {
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
        }
        
        .help-card li::before {
            content: '•';
            color: var(--primary-color);
            font-weight: bold;
            position: absolute;
            left: -12px;
        }
        
        .score-range {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .score-range.high {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .score-range.medium {
            background: linear-gradient(135deg, #eab308, #ca8a04);
            color: white;
        }
        
        .score-range.low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .dimension-detail-btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .dimension-detail-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }
        
        .dimension-detail-btn i {
            font-size: 0.8rem;
        }
        
        /* 详情模态框样式 */
        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .detail-modal-content {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .detail-modal-header {
            padding: 24px 24px 0 24px;
            border-bottom: 1px solid rgba(156, 163, 175, 0.1);
            margin-bottom: 20px;
        }
        
        .detail-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .detail-modal-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0 0 20px 0;
        }
        
        .detail-modal-body {
            padding: 0 24px 24px 24px;
        }
        
        .detail-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .detail-close-btn:hover {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-primary);
        }
        
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .indicator-item {
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            border-radius: var(--border-radius-md);
            padding: 16px;
            border: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .indicator-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .indicator-data {
            display: grid;
            gap: 8px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid rgba(156, 163, 175, 0.05);
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .data-value {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .data-value.positive {
            color: #22c55e;
        }
        
        .data-value.negative {
            color: #ef4444;
        }
        
        .pending-data {
            color: #9ca3af;
            font-style: italic;
            font-size: 0.9em;
        }
        
        .dimension-detail-summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: var(--border-radius-md);
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }
        
        .detail-score {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: white;
        }
        
        .detail-score-desc {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .error {
            text-align: center;
            color: #ef4444;
            padding: 20px;
            font-size: 1rem;
        }
        
        .loading {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            font-size: 1rem;
        }
        
        .dimension-score {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
            margin-bottom: 4px;
        }
        
        .dimension-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .dimension-progress {
            height: 6px;
            background: rgba(156, 163, 175, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .dimension-progress .progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .alerts-opportunities {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 32px 0;
        }
        
        .alerts-section, .opportunities-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-md);
            padding: 20px;
            border: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .alerts-section h4, .opportunities-section h4 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alerts-section h4 i {
            color: #ef4444;
        }
        
        .opportunities-section h4 i {
            color: #eab308;
        }
        
        .alert-item, .opportunity-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: var(--border-radius-sm);
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        .alert-item {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            color: var(--text-primary);
        }
        
        .opportunity-item {
            background: rgba(234, 179, 8, 0.1);
            border-left: 3px solid #eab308;
            color: var(--text-primary);
        }
        
        .alert-item.loading, .opportunity-item.loading {
            opacity: 0.6;
            font-style: italic;
        }
        
        .mood-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 24px;
        }
        
        .mood-refresh-btn, .mood-detail-btn, .mood-history-btn {
            padding: 12px 24px;
            border-radius: var(--border-radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mood-refresh-btn {
            background: var(--primary-gradient);
            color: white;
        }
        
        .mood-detail-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        
        .mood-history-btn {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }
        
        .mood-refresh-btn:hover, .mood-detail-btn:hover, .mood-history-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* 机构行为监控样式 */
        .institutional-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-xl);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .institutional-panel h2 {
            color: var(--text-primary);
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .institutional-panel h2 i {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .institutional-overview {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 32px;
            margin-bottom: 32px;
            padding: 24px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(30, 64, 175, 0.05));
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(59, 130, 246, 0.15);
        }
        
        .consensus-score {
            text-align: center;
        }
        
        .consensus-score h3 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ef4444 0%, #f97316 30%, #eab308 50%, #22c55e 70%, #3b82f6 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto;
            position: relative;
        }
        
        .score-value {
            font-size: 1.75rem;
            line-height: 1;
        }
        
        .score-desc {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 4px;
        }
        
        .main-trend h4 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .main-trend p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 1.05rem;
        }
        
        .institutional-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .institutional-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-md);
            padding: 20px;
            border: 1px solid rgba(156, 163, 175, 0.1);
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .institutional-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .card-header h3 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        
        .detail-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .detail-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .card-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric .label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .metric .value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .sector-consensus {
            margin-bottom: 24px;
        }
        
        .sector-consensus h3 {
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .consensus-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .consensus-group {
            padding: 16px;
            border-radius: var(--border-radius-md);
            border: 2px solid;
        }
        
        .consensus-group.positive {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .consensus-group.neutral {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.05), rgba(107, 114, 128, 0.05));
            border-color: rgba(156, 163, 175, 0.3);
        }
        
        .consensus-group.negative {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(185, 28, 28, 0.05));
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .consensus-group h4 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .sectors {
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .institutional-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 24px;
        }
        
        .refresh-btn, .consensus-btn {
            padding: 12px 24px;
            border-radius: var(--border-radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
        }
        
        .consensus-btn {
            background: linear-gradient(135deg, #6366f1, #4338ca);
            color: white;
        }
        
        .refresh-btn:hover, .consensus-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* ETF详情样式 */
        .market-overview-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: var(--border-radius-md);
        }
        
        .data-explanation {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(217, 119, 6, 0.05));
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 16px;
            border-left: 4px solid var(--warning-color);
        }
        
        .data-explanation p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
        }
        
        .stat-label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .stat-value {
            display: block;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .etf-explanation {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            padding: 16px;
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--success-color);
        }
        
        .etf-item {
            border: 1px solid rgba(156, 163, 175, 0.2);
            border-radius: var(--border-radius-md);
            padding: 20px;
            margin-bottom: 20px;
            background: var(--bg-card);
        }
        
        .etf-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 12px 0;
        }
        
        .etf-type, .fund-size, .next-rebalance {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .fund-size {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .etf-description {
            font-style: italic;
            color: var(--text-muted);
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .change-action.positive {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .change-action.negative {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .trend-analysis {
            display: grid;
            gap: 16px;
        }
        
        .trend-item {
            padding: 16px;
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.05), rgba(107, 114, 128, 0.05));
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--info-color);
        }
        
        .trend-desc {
            margin: 8px 0 0 0;
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
        }
        
        .investment-tips {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(217, 119, 6, 0.05));
            padding: 16px;
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--warning-color);
        }
        
        .investment-tips ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .investment-tips li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        /* ETF流向统计样式 */
        .flow-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .flow-period {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            border-radius: var(--border-radius-md);
            padding: 16px;
            border-left: 4px solid var(--success-color);
        }
        
        .flow-period h5 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .flow-data {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .flow-in {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .flow-out {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .flow-net {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .flow-net.positive {
            color: var(--success-color);
        }
        
        .flow-net.negative {
            color: var(--danger-color);
        }
        
        .category-flows {
            margin: 24px 0;
        }
        
        .category-flows h5 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .flow-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-card);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
        }
        
        .category-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .category-flow {
            font-weight: 600;
        }
        
        .category-flow.positive {
            color: var(--success-color);
        }
        
        .category-flow.negative {
            color: var(--danger-color);
        }
        
        .category-trend {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .sector-flows {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }
        
        .hot-sectors, .cold-sectors {
            padding: 16px;
            border-radius: var(--border-radius-md);
        }
        
        .hot-sectors {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            border-left: 4px solid var(--success-color);
        }
        
        .cold-sectors {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(185, 28, 28, 0.05));
            border-left: 4px solid var(--danger-color);
        }
        
        .hot-sectors h5, .cold-sectors h5 {
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sector-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .sector-item:last-child {
            border-bottom: none;
        }
        
        .sector-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sector-flow {
            font-weight: 600;
            text-align: right;
        }
        
        .sector-flow.positive {
            color: var(--success-color);
        }
        
        .sector-flow.negative {
            color: var(--danger-color);
        }
        
        .sector-reason {
            grid-column: 1 / -1;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .sector-flows {
                grid-template-columns: 1fr;
            }
            
            .flow-stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* 数据源验证样式 */
        .data-source-info {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .verify-btn, .compare-btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .verify-btn {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
        }
        
        .compare-btn {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
        }
        
        .verify-btn:hover, .compare-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .source-quick-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--info-color);
        }
        
        .source-quick-info p {
            margin: 4px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .sources-list {
            display: grid;
            gap: 12px;
        }
        
        .source-item {
            padding: 16px;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(156, 163, 175, 0.2);
        }
        
        .source-item.connected {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            border-color: var(--success-color);
        }
        
        .source-item.not-connected {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.05), rgba(107, 114, 128, 0.05));
            border-color: rgba(156, 163, 175, 0.3);
        }
        
        .source-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .source-header h6 {
            margin: 0;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .source-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .connected .source-status {
            background: var(--success-color);
            color: white;
        }
        
        .not-connected .source-status {
            background: var(--text-muted);
            color: white;
        }
        
        .source-details p {
            margin: 4px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .source-link, .verification-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .source-link:hover, .verification-link:hover {
            text-decoration: underline;
        }
        
        .verification-list {
            display: grid;
            gap: 12px;
        }
        
        .verification-item {
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(217, 119, 6, 0.05));
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--warning-color);
        }
        
        .verification-item h6 {
            margin: 0 0 8px 0;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .verification-item p {
            margin: 4px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(156, 163, 175, 0.1);
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .comparison-table .positive {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .comparison-table .negative {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .differences-analysis {
            margin: 16px 0;
            padding: 16px;
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.05), rgba(107, 114, 128, 0.05));
            border-radius: var(--border-radius-md);
        }
        
        .diff-item {
            margin: 8px 0;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .diff-item span {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .reliability-note {
            padding: 16px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), rgba(21, 128, 61, 0.05));
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--success-color);
            margin-top: 16px;
        }
        
        .reliability-note p {
            margin: 4px 0;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .mood-overview {
                grid-template-columns: 1fr;
                gap: 24px;
                text-align: center;
            }
            
            .alerts-opportunities {
                grid-template-columns: 1fr;
            }
            
            .dimensions-grid {
                grid-template-columns: 1fr;
            }
            
            .mood-actions {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* 市场概览面板样式 */
        .market-overview-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius-md);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .stat-card.up-card .stat-value {
            color: #f5576c;
        }

        .stat-card.down-card .stat-value {
            color: #00c853;
        }

        /* 资金流向面板样式 */
        .capital-flow-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .flow-content {
            margin-top: 20px;
        }

        .today-flow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius-md);
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            color: white;
        }

        .flow-label {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .flow-value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .period-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .period-card {
            background: #f8f9fa;
            border-radius: var(--border-radius-sm);
            padding: 20px 15px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .period-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: #667eea;
        }

        .period-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .period-value {
            font-size: 1.4em;
            font-weight: bold;
            margin: 8px 0;
        }

        .period-value.positive {
            color: #f5576c;
        }

        .period-value.negative {
            color: #00c853;
        }

        .period-sublabel {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* 响应式调整 */
        @media (max-width: 1200px) {
            .period-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .period-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .period-grid {
                grid-template-columns: 1fr;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- 系统头部 -->
        <header class="header">
            <h1>AlphaBloom</h1>
            <p class="subtitle">智能分析443只A股，每日8:00自动生成投资建议</p>
            <div class="system-status" id="systemStatus">
                系统运行中 | <span id="currentTime"></span>
            </div>
        </header>

        <!-- Market Mood 市场情绪面板 -->
        <section class="market-mood-section">
            <div class="market-mood-panel">
                <h2><i class="fas fa-brain"></i> Market Mood - 市场情绪监控</h2>
                
                <!-- 情绪概览 -->
                <div class="mood-overview">
                    <div class="mood-score-display">
                        <div class="mood-circle">
                            <span id="moodScore">--</span>
                            <small>/100</small>
                        </div>
                        <div class="mood-level" id="moodLevel">分析中...</div>
                        <div class="mood-description" id="moodDescription">正在分析市场情绪...</div>
                    </div>
                    
                    <div class="action-recommendation">
                        <div class="action-type" id="actionType">
                            <i class="fas fa-hourglass-half"></i> 待分析
                        </div>
                        <div class="action-description" id="actionDescription">
                            等待市场数据分析...
                        </div>
                        <div class="confidence-level">
                            <span>信号强度: </span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill"></div>
                                <span class="confidence-text" id="confidenceText">--%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 五维度分析 -->
                <div class="mood-dimensions">
                    <h3><i class="fas fa-chart-pie"></i> 市场情绪五维度分析</h3>
                    <div class="dimensions-explanation">
                        <p>通过5个关键维度分析市场整体情绪，帮您判断今天是"追涨日"、"观望日"还是"抄底日"</p>
                    </div>
                    <div class="dimensions-grid">
                        <div class="dimension-card" data-tooltip="监测涨跌家数、成交量、两融余额等指标，反映市场整体活跃度">
                            <div class="dimension-header">
                                <i class="fas fa-thermometer-half"></i>
                                <span>市场温度</span>
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </div>
                            <div class="dimension-score" id="temperatureScore">--</div>
                            <div class="dimension-status" id="temperatureStatus">分析中</div>
                            <div class="dimension-progress">
                                <div class="progress-bar" id="temperatureProgress"></div>
                            </div>
                            <div class="dimension-meaning">
                                <small>🔥 高温：市场活跃，可考虑参与</small>
                            </div>
                            <button class="dimension-detail-btn" onclick="showDimensionDetail('market_temperature')">
                                <i class="fas fa-chart-bar"></i> 查看详情
                            </button>
                        </div>
                        
                        <div class="dimension-card" data-tooltip="跟踪各行业板块轮动情况，识别当前热点和冷门板块">
                            <div class="dimension-header">
                                <i class="fas fa-fire"></i>
                                <span>行业热力</span>
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </div>
                            <div class="dimension-score" id="sectorScore">--</div>
                            <div class="dimension-status" id="sectorStatus">分析中</div>
                            <div class="dimension-progress">
                                <div class="progress-bar" id="sectorProgress"></div>
                            </div>
                            <div class="dimension-meaning">
                                <small>🚀 火爆：有明确热点，关注龙头</small>
                            </div>
                            <button class="dimension-detail-btn" onclick="showDimensionDetail('sector_heat')">
                                <i class="fas fa-chart-bar"></i> 查看详情
                            </button>
                        </div>
                        
                        <div class="dimension-card" data-tooltip="监控北向资金、ETF申赎、融资融券等资金流向变化">
                            <div class="dimension-header">
                                <i class="fas fa-exchange-alt"></i>
                                <span>资金流向</span>
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </div>
                            <div class="dimension-score" id="capitalScore">--</div>
                            <div class="dimension-status" id="capitalStatus">分析中</div>
                            <div class="dimension-progress">
                                <div class="progress-bar" id="capitalProgress"></div>
                            </div>
                            <div class="dimension-meaning">
                                <small>💰 流入：增量资金入场，看好后市</small>
                            </div>
                            <button class="dimension-detail-btn" onclick="showDimensionDetail('capital_flow')">
                                <i class="fas fa-chart-bar"></i> 查看详情
                            </button>
                        </div>
                        
                        <div class="dimension-card" data-tooltip="分析主要指数技术走势、均线突破、量价配合等技术信号">
                            <div class="dimension-header">
                                <i class="fas fa-chart-line"></i>
                                <span>技术信号</span>
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </div>
                            <div class="dimension-score" id="technicalScore">--</div>
                            <div class="dimension-status" id="technicalStatus">分析中</div>
                            <div class="dimension-progress">
                                <div class="progress-bar" id="technicalProgress"></div>
                            </div>
                            <div class="dimension-meaning">
                                <small>📈 强势：技术面配合，可积极操作</small>
                            </div>
                            <button class="dimension-detail-btn" onclick="showDimensionDetail('technical_signals')">
                                <i class="fas fa-chart-bar"></i> 查看详情
                            </button>
                        </div>
                        
                        <div class="dimension-card" data-tooltip="基于恐惧贪婪指数、VIX波动率等情绪指标判断市场情绪极端程度">
                            <div class="dimension-header">
                                <i class="fas fa-heart-pulse"></i>
                                <span>情绪指标</span>
                                <i class="fas fa-info-circle tooltip-icon"></i>
                            </div>
                            <div class="dimension-score" id="sentimentScore">--</div>
                            <div class="dimension-status" id="sentimentStatus">分析中</div>
                            <div class="dimension-progress">
                                <div class="progress-bar" id="sentimentProgress"></div>
                            </div>
                            <div class="dimension-meaning">
                                <small>😨 恐慌：情绪极端，可能有抄底机会</small>
                            </div>
                            <button class="dimension-detail-btn" onclick="showDimensionDetail('sentiment_indicators')">
                                <i class="fas fa-chart-bar"></i> 查看详情
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 风险警报与投资机会 -->
                <div class="alerts-opportunities">
                    <div class="alerts-section">
                        <h4><i class="fas fa-exclamation-triangle"></i> 风险警报</h4>
                        <div class="alerts-list" id="riskAlerts">
                            <div class="alert-item loading">正在分析风险因子...</div>
                        </div>
                    </div>
                    
                    <div class="opportunities-section">
                        <h4><i class="fas fa-star"></i> 投资机会</h4>
                        <div class="opportunities-list" id="opportunities">
                            <div class="opportunity-item loading">正在发现投资机会...</div>
                        </div>
                    </div>
                </div>

                <!-- Market Mood 使用说明 -->
                <div class="mood-help-section">
                    <div class="help-toggle" onclick="toggleHelpSection()">
                        <h4><i class="fas fa-question-circle"></i> 如何使用Market Mood <i class="fas fa-chevron-down toggle-icon"></i></h4>
                    </div>
                    <div class="help-content" id="helpContent" style="display: none;">
                        <div class="help-grid">
                            <div class="help-card">
                                <h5>📊 评分含义</h5>
                                <ul>
                                    <li><span class="score-range high">80-100分</span>：市场情绪极度乐观，多头氛围浓厚</li>
                                    <li><span class="score-range medium">40-79分</span>：市场情绪相对平衡，以观察为主</li>
                                    <li><span class="score-range low">0-39分</span>：市场情绪悲观，可能有抄底机会</li>
                                </ul>
                            </div>
                            
                            <div class="help-card">
                                <h5>🎯 行动策略</h5>
                                <ul>
                                    <li><strong>🚀 追涨日</strong>：市场情绪积极，适度参与强势品种，控制仓位</li>
                                    <li><strong>⏳ 观望日</strong>：市场信号混杂，保持耐心，等待更明确方向</li>
                                    <li><strong>💰 抄底日</strong>：市场恐慌，优质股超跌，分批建仓好时机</li>
                                </ul>
                            </div>
                            
                            <div class="help-card">
                                <h5>⚠️ 注意事项</h5>
                                <ul>
                                    <li>Market Mood仅供参考，需结合个股基本面分析</li>
                                    <li>极端情绪往往是反向指标，要有逆向思维</li>
                                    <li>任何时候都要控制风险，切勿满仓操作</li>
                                    <li>建议配合技术分析和资金管理使用</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="mood-actions">
                    <button class="mood-refresh-btn" onclick="refreshEntrySignal()">
                        <i class="fas fa-sync-alt"></i> 刷新分析
                    </button>
                    <button class="mood-detail-btn" onclick="showMoodDetail()">
                        <i class="fas fa-file-alt"></i> 详细报告
                    </button>
                    <button class="mood-history-btn" onclick="showMoodHistory()">
                        <i class="fas fa-history"></i> 历史记录
                    </button>
                </div>
            </div>
        </section>

        <!-- 机构行为监控面板 -->
        <section class="institutional-section">
            <div class="institutional-panel">
                <h2><i class="fas fa-building"></i> 机构行为监控</h2>
                
                <!-- 机构共识概览 -->
                <div class="institutional-overview">
                    <div class="consensus-score">
                        <h3>机构共识度</h3>
                        <div class="score-circle">
                            <div class="score-value" id="consensusScore">--</div>
                            <div class="score-desc" id="consensusDesc">加载中...</div>
                        </div>
                    </div>
                    <div class="main-trend">
                        <h4>主要趋势</h4>
                        <p id="mainTrend">正在获取机构动向...</p>
                    </div>
                </div>

                <!-- 机构行为卡片 -->
                <div class="institutional-cards">
                    <!-- ETF调仓卡片 -->
                    <div class="institutional-card etf-card">
                        <div class="card-header">
                            <h3><i class="fas fa-exchange-alt"></i> ETF调仓</h3>
                            <button class="detail-btn" onclick="showInstitutionalDetail('etf')">详情</button>
                        </div>
                        <div class="card-content">
                            <div class="metric">
                                <span class="label">跟踪ETF数量</span>
                                <span class="value" id="etfCount">--</span>
                            </div>
                            <div class="metric">
                                <span class="label">调仓方向</span>
                                <span class="value" id="etfTrend">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- 北向资金卡片 -->
                    <div class="institutional-card northbound-card">
                        <div class="card-header">
                            <h3><i class="fas fa-globe"></i> 北向资金</h3>
                            <button class="detail-btn" onclick="showInstitutionalDetail('foreign')">详情</button>
                        </div>
                        <div class="card-content">
                            <div class="metric">
                                <span class="label">今日净流入</span>
                                <span class="value" id="northboundFlow">--</span>
                            </div>
                            <div class="metric">
                                <span class="label">投资情绪</span>
                                <span class="value" id="foreignSentiment">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- 社保资金卡片 -->
                    <div class="institutional-card social-security-card">
                        <div class="card-header">
                            <h3><i class="fas fa-shield-alt"></i> 社保资金</h3>
                            <button class="detail-btn" onclick="showInstitutionalDetail('social')">详情</button>
                        </div>
                        <div class="card-content">
                            <div class="metric">
                                <span class="label">持仓变动</span>
                                <span class="value" id="socialMoves">--</span>
                            </div>
                            <div class="metric">
                                <span class="label">配置重点</span>
                                <span class="value" id="socialFocus">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- 私募基金卡片 -->
                    <div class="institutional-card private-equity-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-area"></i> 私募基金</h3>
                            <button class="detail-btn" onclick="showInstitutionalDetail('private')">详情</button>
                        </div>
                        <div class="card-content">
                            <div class="metric">
                                <span class="label">整体仓位</span>
                                <span class="value" id="privatePosition">--</span>
                            </div>
                            <div class="metric">
                                <span class="label">仓位变化</span>
                                <span class="value" id="privateChange">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 板块共识 -->
                <div class="sector-consensus">
                    <h3>板块共识</h3>
                    <div class="consensus-grid">
                        <div class="consensus-group positive">
                            <h4>强烈看好</h4>
                            <div class="sectors" id="bullishSectors">--</div>
                        </div>
                        <div class="consensus-group neutral">
                            <h4>保持中性</h4>
                            <div class="sectors" id="neutralSectors">--</div>
                        </div>
                        <div class="consensus-group negative">
                            <h4>相对谨慎</h4>
                            <div class="sectors" id="bearishSectors">--</div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="institutional-actions">
                    <button class="refresh-btn" onclick="refreshInstitutionalData()">
                        <i class="fas fa-sync-alt"></i> 刷新数据
                    </button>
                    <button class="consensus-btn" onclick="showConsensusAnalysis()">
                        <i class="fas fa-users"></i> 共识分析
                    </button>
                </div>
            </div>
        </section>

        <!-- 市场概览面板 -->
        <section class="market-overview-section">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> 市场概览</h2>
                <button class="refresh-btn" onclick="refreshMarketOverview()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
            </div>

            <div class="stats-grid">
                <!-- 上涨家数卡片 -->
                <div class="stat-card up-card">
                    <div class="stat-icon">📈</div>
                    <div class="stat-label">上涨家数</div>
                    <div class="stat-value" id="upCount">--</div>
                </div>

                <!-- 下跌家数卡片 -->
                <div class="stat-card down-card">
                    <div class="stat-icon">📉</div>
                    <div class="stat-label">下跌家数</div>
                    <div class="stat-value" id="downCount">--</div>
                </div>

                <!-- 涨跌比卡片 -->
                <div class="stat-card ratio-card">
                    <div class="stat-icon">⚖️</div>
                    <div class="stat-label">涨跌比</div>
                    <div class="stat-value" id="upDownRatio">--</div>
                </div>

                <!-- 市场情绪卡片 -->
                <div class="stat-card sentiment-card">
                    <div class="stat-icon">🎯</div>
                    <div class="stat-label">市场情绪</div>
                    <div class="stat-value" id="marketSentiment">--</div>
                </div>
            </div>
        </section>

        <!-- 资金流向面板 -->
        <section class="capital-flow-section">
            <div class="section-header">
                <h2><i class="fas fa-money-bill-wave"></i> 北向资金流向</h2>
                <button class="refresh-btn" onclick="refreshCapitalFlow()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
            </div>

            <div class="flow-content">
                <!-- 今日数据 -->
                <div class="today-flow">
                    <div class="flow-label">今日净流入</div>
                    <div class="flow-value" id="todayFlow">--</div>
                </div>

                <!-- 多周期统计 -->
                <div class="period-grid">
                    <div class="period-card">
                        <div class="period-label">1日</div>
                        <div class="period-value" id="flow1d">--</div>
                        <div class="period-sublabel">日均</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">3日</div>
                        <div class="period-value" id="flow3d">--</div>
                        <div class="period-sublabel">累计</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">7日</div>
                        <div class="period-value" id="flow7d">--</div>
                        <div class="period-sublabel">累计</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">14日</div>
                        <div class="period-value" id="flow14d">--</div>
                        <div class="period-sublabel">累计</div>
                    </div>
                    <div class="period-card">
                        <div class="period-label">28日</div>
                        <div class="period-value" id="flow28d">--</div>
                        <div class="period-sublabel">累计</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 控制区域 -->
        <section class="control-section">
            <div class="analysis-control">
                <h2><i class="fas fa-chart-line"></i> 分析控制</h2>
                <div class="analysis-info">
                    <div class="status-item">
                        <span>上次分析:</span>
                        <strong id="lastAnalysis">2025-11-06 08:00</strong>
                    </div>
                    <div class="status-item">
                        <span>分析股票:</span>
                        <strong id="stockCount">443只</strong>
                    </div>
                    <div class="status-item">
                        <span>成功率:</span>
                        <strong id="successRate">98.5%</strong>
                    </div>
                    <div class="status-item">
                        <span>下次分析:</span>
                        <strong id="nextAnalysis">明日08:00</strong>
                    </div>
                </div>
                <button class="main-button" id="analyzeButton" onclick="startAnalysis()">
                    <i class="fas fa-rocket"></i> 启动全量分析
                </button>
                <button class="main-button secondary" onclick="loadDecisionData()">
                    <i class="fas fa-sync-alt"></i> 刷新数据
                </button>
            </div>

            <div class="quick-stats">
                <h2><i class="fas fa-chart-area"></i> 今日概况</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="buySignals">12</div>
                        <div class="stat-label">买入信号</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="sellSignals">5</div>
                        <div class="stat-label">卖出信号</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="holdSignals">426</div>
                        <div class="stat-label">持有观望</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="riskLevel">中等</div>
                        <div class="stat-label">市场风险</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI决策区域 -->
        <section class="decision-section">
            <div class="decision-card">
                <div class="decision-header buy-header">
                    <i class="fas fa-arrow-trend-up"></i> 买入建议 (<span id="buyCount">12</span>)
                </div>
                <div class="decision-content" id="buyList">
                    <div class="stock-item buy">
                        <div class="stock-code">000001 平安银行</div>
                        <div class="stock-price">¥11.53 (+0.9%)</div>
                        <div class="stock-reason">技术面突破关键阻力位，成交量放大，建议逢低买入</div>
                    </div>
                    <div class="stock-item buy">
                        <div class="stock-code">000858 五粮液</div>
                        <div class="stock-price">¥128.45 (+1.2%)</div>
                        <div class="stock-reason">白酒板块回暖，基本面稳定，消费复苏预期</div>
                    </div>
                </div>
            </div>

            <div class="decision-card">
                <div class="decision-header sell-header">
                    <i class="fas fa-arrow-trend-down"></i> 卖出建议 (<span id="sellCount">5</span>)
                </div>
                <div class="decision-content" id="sellList">
                    <div class="stock-item sell">
                        <div class="stock-code">300999 金龙鱼</div>
                        <div class="stock-price">¥45.67 (-2.1%)</div>
                        <div class="stock-reason">业绩不及预期，行业竞争加剧，建议减仓止损</div>
                    </div>
                </div>
            </div>

            <div class="decision-card">
                <div class="decision-header hold-header">
                    <i class="fas fa-pause"></i> 持有观望 (<span id="holdCount">426</span>)
                </div>
                <div class="decision-content" id="holdList">
                    <div class="stock-item hold">
                        <div class="stock-code">600519 贵州茅台</div>
                        <div class="stock-price">¥1430.18 (-0.3%)</div>
                        <div class="stock-reason">高位震荡，等待明确方向，暂时持有观望</div>
                    </div>
                    <div class="stock-item hold">
                        <div class="stock-code">000002 万科A</div>
                        <div class="stock-price">¥6.26 (-0.3%)</div>
                        <div class="stock-reason">地产政策不明朗，短期观望为主</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 市场概况 -->
        <section class="market-overview">
            <h2><i class="fas fa-chart-pie"></i> 今日市场分析</h2>
            <div class="market-summary">
                <h3><i class="fas fa-chart-bar"></i> 市场总体判断</h3>
                <div class="market-text" id="marketAnalysis">
                    今日A股市场呈现震荡整理格局，沪深两市成交量较昨日略有放大。权重股表现平稳，中小创板块活跃度提升。
                    从技术面看，主要指数在关键支撑位获得支撑，短期有望延续反弹行情。建议保持谨慎乐观态度，
                    重点关注有业绩支撑的优质个股，控制仓位，注重选股。
                </div>
            </div>
            
            <div class="risk-alerts">
                <h4><i class="fas fa-exclamation-triangle"></i> 风险提示</h4>
                <ul>
                    <li>市场情绪波动较大，避免追涨杀跌</li>
                    <li>关注政策变化和外围市场影响</li>
                    <li>严格执行止损策略，控制单笔损失</li>
                    <li>分散投资，降低集中度风险</li>
                </ul>
            </div>
        </section>
    </div>

    <!-- 通知组件 -->
    <div class="notification" id="notification"></div>

    <script>
        // 格式化市场分析文本
        function formatMarketAnalysis(marketContext) {
            if (!marketContext) return '';
            
            // 解析市场环境数据
            const lines = marketContext.split('\n');
            let formattedText = '';
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                if (line.startsWith('市场环境:')) {
                    return; // 跳过标题
                } else if (line.startsWith('大盘:')) {
                    const content = line.replace('大盘:', '').trim();
                    formattedText += `<strong>📈 大盘走势：</strong>${content}<br><br>`;
                } else if (line.startsWith('指数:')) {
                    const content = line.replace('指数:', '').trim();
                    formattedText += `<strong>📊 主要指数：</strong>${content}<br><br>`;
                } else if (line.startsWith('涨跌:')) {
                    const content = line.replace('涨跌:', '').trim();
                    formattedText += `<strong>📶 涨跌分布：</strong>${content}<br><br>`;
                } else if (line.startsWith('情绪:')) {
                    const content = line.replace('情绪:', '').trim();
                    formattedText += `<strong>💭 市场情绪：</strong>${content}`;
                } else if (line.startsWith('换手:')) {
                    const content = line.replace('换手:', '').trim();
                    formattedText += ` | <strong>🔄 换手率：</strong>${content}`;
                } else if (line.startsWith('热点:')) {
                    const content = line.replace('热点:', '').trim();
                    let hotspots = content;
                    try {
                        // 尝试解析JSON数组
                        const parsed = JSON.parse(content);
                        if (Array.isArray(parsed)) {
                            hotspots = parsed.join('、');
                        }
                    } catch (e) {
                        // 如果不是JSON格式，直接使用原文本
                    }
                    formattedText += `<br><br><strong>🔥 热点板块：</strong>${hotspots}`;
                }
            });
            
            // 如果没有成功解析，返回简化的原文本
            if (!formattedText.trim()) {
                return marketContext.replace(/\n/g, '<br>');
            }
            
            return formattedText;
        }

        // 更新时间
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // 启动分析
        function startAnalysis() {
            const button = document.getElementById('analyzeButton');
            const originalText = button.textContent;
            
            // 更新按钮状态
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span>分析中...';
            
            showNotification('启动全量分析，预计需要15-20分钟');
            
            // 调用决策分析API
            fetch('http://localhost:8526/api/trigger-analysis', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('分析任务已启动，请稍后查看结果');
                    // 开始轮询状态
                    pollAnalysisStatus();
                } else {
                    showNotification('分析启动失败: ' + data.error, 'error');
                    resetButton();
                }
            })
            .catch(error => {
                console.log('API不可用，使用模拟分析...');
                showNotification('正在启动本地分析...', 'info');
                
                // 模拟分析过程
                setTimeout(() => {
                    showNotification('分析完成！正在更新决策数据...');
                    loadDecisionData();
                    resetButton();
                }, 5000);
            });

            function resetButton() {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        // 轮询分析状态
        function pollAnalysisStatus() {
            const interval = setInterval(() => {
                fetch('http://localhost:8526/api/analysis-status')
                .then(response => response.json())
                .then(data => {
                    if (!data.analysis_running) {
                        clearInterval(interval);
                        showNotification('分析完成！');
                        loadDecisionData();
                        document.getElementById('analyzeButton').disabled = false;
                        document.getElementById('analyzeButton').innerHTML = '🚀 启动全量分析';
                    }
                })
                .catch(() => {
                    clearInterval(interval);
                    document.getElementById('analyzeButton').disabled = false;
                    document.getElementById('analyzeButton').innerHTML = '🚀 启动全量分析';
                });
            }, 10000);
        }

        // 加载决策数据
        function loadDecisionData() {
            fetch('http://localhost:8526/api/decisions')
            .then(response => response.json())
            .then(data => {
                if (data && data.analysis_time) {
                    updateDecisionDisplay(data);
                    updateSystemStatus(data);
                } else {
                    console.log('暂无决策数据');
                }
            })
            .catch(error => {
                console.log('API不可用，使用默认数据');
                loadSystemStatus();
            });
        }

        // 更新决策展示
        function updateDecisionDisplay(data) {
            // 确保数据存在，如果不存在则设为空数组
            const buyStocks = data.buy_stocks || [];
            const sellStocks = data.sell_stocks || [];
            const holdStocks = data.hold_stocks || [];
            
            // 更新买入列表
            updateStockList('buyList', buyStocks, 'buy');
            
            // 更新卖出列表  
            updateStockList('sellList', sellStocks, 'sell');
            
            // 更新持有列表
            updateStockList('holdList', holdStocks, 'hold');
            
            // 更新数量统计
            document.getElementById('buyCount').textContent = buyStocks.length;
            document.getElementById('sellCount').textContent = sellStocks.length;
            document.getElementById('holdCount').textContent = holdStocks.length;
            
            document.getElementById('buySignals').textContent = buyStocks.length;
            document.getElementById('sellSignals').textContent = sellStocks.length;
            document.getElementById('holdSignals').textContent = holdStocks.length;
            
            // 更新市场分析
            if (data.market_context && data.market_context.trim() !== '') {
                console.log('收到市场环境数据:', data.market_context);
                const formattedMarketAnalysis = formatMarketAnalysis(data.market_context);
                console.log('格式化后的市场分析:', formattedMarketAnalysis);
                document.getElementById('marketAnalysis').innerHTML = formattedMarketAnalysis;
            } else {
                console.log('未收到市场环境数据或数据为空');
            }
            
            // 更新风险等级（基于市场环境推断）
            let riskLevel = '中等';
            if (data.market_context) {
                if (data.market_context.includes('上涨') || data.market_context.includes('乐观')) {
                    riskLevel = '偏低';
                } else if (data.market_context.includes('下跌') || data.market_context.includes('谨慎')) {
                    riskLevel = '偏高';
                }
            }
            document.getElementById('riskLevel').textContent = riskLevel;
        }

        // 更新股票列表
        function updateStockList(containerId, stocks, type) {
            const container = document.getElementById(containerId);
            
            if (!stocks || stocks.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">暂无数据</div>';
                return;
            }
            
            container.innerHTML = '';
            
            stocks.forEach(stock => {
                const stockItem = document.createElement('div');
                stockItem.className = `stock-item ${type}`;
                
                const changeSymbol = stock.change_pct >= 0 ? '+' : '';
                const changeColor = stock.change_pct >= 0 ? '#28a745' : '#dc3545';
                
                stockItem.innerHTML = `
                    <div class="stock-code">${stock.symbol} ${stock.name}</div>
                    <div class="stock-price" style="color: ${changeColor}">¥${stock.price.toFixed(2)} (${changeSymbol}${stock.change_pct.toFixed(1)}%)</div>
                    <div class="stock-reason">${stock.reason}</div>
                `;
                
                container.appendChild(stockItem);
            });
        }

        // 加载系统状态
        function loadSystemStatus() {
            fetch('http://localhost:8526/api/status')
            .then(response => response.json())
            .then(data => {
                if (data.last_analysis) {
                    document.getElementById('lastAnalysis').textContent = data.last_analysis;
                    document.getElementById('stockCount').textContent = `${data.stock_count}只`;
                    document.getElementById('successRate').textContent = '98.5%';
                    
                    // 更新下次分析时间
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    tomorrow.setHours(8, 0, 0, 0);
                    document.getElementById('nextAnalysis').textContent = 
                        tomorrow.toLocaleDateString('zh-CN') + ' 08:00';
                }
            })
            .catch(error => {
                console.log('状态API不可用');
            });
        }

        // 更新系统状态
        function updateSystemStatus(data) {
            if (data.analysis_time) {
                const analysisTime = new Date(data.analysis_time);
                document.getElementById('lastAnalysis').textContent = 
                    analysisTime.toLocaleString('zh-CN').slice(0, -3);
            }
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // 页面加载完成
        window.addEventListener('load', () => {
            setTimeout(() => {
                showNotification('AI决策中心已就绪');
            }, 1000);

            // 加载初始数据
            loadDecisionData();
            loadEntrySignal();
            loadInstitutionalData();
            loadMarketOverview();
            loadCapitalFlow();

            // 初始化工具提示
            initTooltips();

            // 自动刷新市场数据（5分钟）
            setInterval(() => {
                loadMarketOverview();
                loadCapitalFlow();
            }, 5 * 60 * 1000);
        });

        // Market Mood相关函数
        function loadEntrySignal() {
            fetch('http://localhost:8526/api/market-mood')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMarketMood(data.data);
                    } else {
                        showNotification('Market Mood获取失败: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('加载Market Mood失败:', error);
                    showNotification('Market Mood服务连接失败', 'error');
                });
        }

        function displayMarketMood(moodData) {
            // 更新Market Mood Score
            document.getElementById('moodScore').textContent = Math.round(moodData.mood_score) || '--';
            
            // 更新情绪等级和描述
            const moodLevelMap = {
                'panic': '😨 恐慌',
                'cautious': '😟 谨慎', 
                'neutral': '😐 中性',
                'optimistic': '😊 乐观',
                'euphoric': '🤩 亢奋'
            };
            
            document.getElementById('moodLevel').textContent = moodLevelMap[moodData.mood_level] || '😐 中性';
            document.getElementById('moodDescription').textContent = moodData.mood_description || '正在分析市场情绪...';
            
            // 更新行动建议
            const actionIcons = {
                '追涨日': '<i class="fas fa-rocket"></i>',
                '观望日': '<i class="fas fa-hourglass-half"></i>',
                '抄底日': '<i class="fas fa-chart-line-down"></i>'
            };
            
            document.getElementById('actionType').innerHTML = `${actionIcons[moodData.action_type] || '<i class="fas fa-hourglass-half"></i>'} ${moodData.action_type || '待分析'}`;
            document.getElementById('actionDescription').textContent = moodData.action_description || '等待市场数据分析...';
            
            // 更新信号强度
            const confidencePercent = Math.round((moodData.confidence || 0) * 100);
            document.getElementById('confidenceFill').style.width = confidencePercent + '%';
            document.getElementById('confidenceText').textContent = confidencePercent + '%';
            
            // 更新五个维度 - 暂时用计算数据，后续可从详细API获取
            const dimensions = [
                { 
                    id: 'temperature', 
                    score: moodData.mood_score || 0, 
                    status: getScoreStatus(moodData.mood_score),
                    progressId: 'temperatureProgress'
                },
                { 
                    id: 'sector', 
                    score: Math.min(100, (moodData.mood_score * 1.1)) || 0, 
                    status: getScoreStatus(moodData.mood_score * 1.1),
                    progressId: 'sectorProgress'
                },
                { 
                    id: 'capital', 
                    score: Math.max(0, (moodData.mood_score * 0.9)) || 0, 
                    status: getScoreStatus(moodData.mood_score * 0.9),
                    progressId: 'capitalProgress'
                },
                { 
                    id: 'technical', 
                    score: Math.min(100, (moodData.mood_score + 10)) || 0, 
                    status: getScoreStatus(moodData.mood_score + 10),
                    progressId: 'technicalProgress'
                },
                { 
                    id: 'sentiment', 
                    score: moodData.mood_score || 0, 
                    status: getScoreStatus(moodData.mood_score),
                    progressId: 'sentimentProgress'
                }
            ];
            
            dimensions.forEach(dim => {
                const score = Math.min(Math.max(dim.score, 0), 100);
                const scoreElement = document.getElementById(dim.id + 'Score');
                const statusElement = document.getElementById(dim.id + 'Status');
                const progressElement = document.getElementById(dim.progressId);
                
                if (scoreElement) scoreElement.textContent = score.toFixed(1);
                if (statusElement) statusElement.textContent = dim.status;
                if (progressElement) {
                    progressElement.style.width = score + '%';
                    progressElement.style.background = getScoreColor(score);
                }
                
                // 更新投资含义
                updateDimensionMeaning(dim.id, score);
            });
            
            // 更新风险警报
            const riskAlertsElement = document.getElementById('riskAlerts');
            if (riskAlertsElement) {
                if (moodData.risk_alerts && moodData.risk_alerts.length > 0) {
                    riskAlertsElement.innerHTML = moodData.risk_alerts.map(alert => 
                        `<div class="alert-item">${alert}</div>`
                    ).join('');
                } else {
                    riskAlertsElement.innerHTML = '<div class="alert-item loading">暂无风险警报</div>';
                }
            }
            
            // 更新投资机会
            const opportunitiesElement = document.getElementById('opportunities');
            if (opportunitiesElement) {
                if (moodData.opportunities && moodData.opportunities.length > 0) {
                    opportunitiesElement.innerHTML = moodData.opportunities.map(opportunity => 
                        `<div class="opportunity-item">${opportunity}</div>`
                    ).join('');
                } else {
                    opportunitiesElement.innerHTML = '<div class="opportunity-item loading">暂无明显机会</div>';
                }
            }
        }
        
        function getScoreStatus(score) {
            if (score >= 80) return '火热';
            if (score >= 60) return '偏热';  
            if (score >= 40) return '温和';
            if (score >= 20) return '偏冷';
            return '冰冷';
        }
        
        function getScoreColor(score) {
            if (score >= 70) return 'linear-gradient(90deg, #22c55e, #16a34a)';
            if (score >= 50) return 'linear-gradient(90deg, #eab308, #ca8a04)';
            return 'linear-gradient(90deg, #ef4444, #dc2626)';
        }
        
        function updateDimensionMeaning(dimensionId, score) {
            const meanings = {
                temperature: {
                    high: '🔥 高温：市场活跃，可考虑参与',
                    medium: '☀️ 正常：市场平稳，谨慎操作',
                    low: '❄️ 冰点：市场冷清，注意风险'
                },
                sector: {
                    high: '🚀 火爆：有明确热点，关注龙头',
                    medium: '⚡ 温和：板块轮动，精选个股',
                    low: '😴 冷淡：缺乏热点，等待机会'
                },
                capital: {
                    high: '💰 流入：增量资金入场，看好后市',
                    medium: '💧 平衡：资金观望，保持耐心',
                    low: '📤 流出：资金撤离，控制仓位'
                },
                technical: {
                    high: '📈 强势：技术面配合，可积极操作',
                    medium: '📊 震荡：技术信号混杂，谨慎判断',
                    low: '📉 疲弱：技术面偏弱，注意止损'
                },
                sentiment: {
                    high: '🤩 亢奋：情绪过热，警惕回调',
                    medium: '😐 平静：情绪理性，基本面选股',
                    low: '😨 恐慌：情绪极端，可能有抄底机会'
                }
            };
            
            const level = score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low';
            const meaningElement = document.querySelector(`#${dimensionId}Score`).parentNode.querySelector('.dimension-meaning small');
            
            if (meaningElement && meanings[dimensionId]) {
                meaningElement.textContent = meanings[dimensionId][level];
            }
        }
        
        // 工具提示功能
        function initTooltips() {
            const tooltipIcons = document.querySelectorAll('.tooltip-icon');
            
            tooltipIcons.forEach(icon => {
                icon.addEventListener('mouseenter', (e) => {
                    const card = e.target.closest('.dimension-card');
                    const tooltip = card.getAttribute('data-tooltip');
                    
                    if (tooltip) {
                        showTooltip(e.target, tooltip);
                    }
                });
                
                icon.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            });
        }
        
        function showTooltip(element, text) {
            const tooltip = document.createElement('div');
            tooltip.className = 'custom-tooltip';
            tooltip.textContent = text;
            
            document.body.appendChild(tooltip);
            
            const rect = element.getBoundingClientRect();
            tooltip.style.position = 'absolute';
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 10 + 'px';
            tooltip.style.zIndex = '1000';
        }
        
        function hideTooltip() {
            const tooltip = document.querySelector('.custom-tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        function refreshEntrySignal() {
            const refreshBtn = document.querySelector('.signal-refresh-btn');
            const originalHTML = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = '<div class="loading"></div> 刷新中...';
            refreshBtn.disabled = true;
            
            loadEntrySignal();
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalHTML;
                refreshBtn.disabled = false;
            }, 2000);
        }

        function showSignalHistory() {
            showNotification('历史信号记录功能开发中', 'info');
        }
        
        function showMoodDetail() {
            // 显示详细的Market Mood报告
            fetch('http://localhost:5010/api/market-mood/report')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 这里可以打开一个模态框显示详细报告
                        showNotification('详细报告功能开发中', 'info');
                    } else {
                        showNotification('获取详细报告失败', 'error');
                    }
                })
                .catch(error => {
                    console.error('获取详细报告失败:', error);
                    showNotification('详细报告服务连接失败', 'error');
                });
        }
        
        function showMoodHistory() {
            showNotification('Market Mood历史记录功能开发中', 'info');
        }
        
        function toggleHelpSection() {
            const helpContent = document.getElementById('helpContent');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            if (helpContent.style.display === 'none') {
                helpContent.style.display = 'block';
                toggleIcon.classList.add('rotated');
            } else {
                helpContent.style.display = 'none';
                toggleIcon.classList.remove('rotated');
            }
        }
        
        function showDimensionDetail(dimensionType) {
            const modal = document.getElementById('dimensionDetailModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalIcon = document.getElementById('modalIcon');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalBody = document.getElementById('modalBody');
            
            // 设置标题和图标
            const dimensionConfig = {
                'market_temperature': {
                    title: '市场温度计详细数据',
                    icon: 'fas fa-thermometer-half',
                    subtitle: '监测涨跌家数、成交量、两融余额等指标，反映市场整体活跃度'
                },
                'sector_heat': {
                    title: '行业热力图详细数据',
                    icon: 'fas fa-fire',
                    subtitle: '跟踪各行业板块轮动情况，识别当前热点和冷门板块'
                },
                'capital_flow': {
                    title: '资金流向详细数据',
                    icon: 'fas fa-exchange-alt',
                    subtitle: '监控北向资金、ETF申赎、融资融券等资金流向变化'
                },
                'technical_signals': {
                    title: '技术信号详细数据',
                    icon: 'fas fa-chart-line',
                    subtitle: '分析主要指数技术走势、均线突破、量价配合等技术信号'
                },
                'sentiment_indicators': {
                    title: '情绪指标详细数据',
                    icon: 'fas fa-heart-pulse',
                    subtitle: '基于恐惧贪婪指数、VIX波动率等情绪指标判断市场情绪极端程度'
                }
            };
            
            const config = dimensionConfig[dimensionType];
            modalIcon.className = config.icon;
            modalTitle.innerHTML = `<i class="${config.icon}"></i> ${config.title}`;
            modalSubtitle.textContent = config.subtitle;
            modalBody.innerHTML = '<div class="loading">正在获取详细数据...</div>';
            
            // 显示模态框
            modal.style.display = 'flex';
            
            // 获取详细数据
            fetch('http://localhost:5010/api/market-mood/details')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const dimensionData = data.data[dimensionType];
                        displayDimensionDetailData(dimensionData);
                    } else {
                        modalBody.innerHTML = '<div class="error">获取数据失败: ' + data.error + '</div>';
                    }
                })
                .catch(error => {
                    console.error('获取维度详情失败:', error);
                    modalBody.innerHTML = '<div class="error">连接服务失败，请稍后重试</div>';
                });
        }
        
        function displayDimensionDetailData(dimensionData) {
            const modalBody = document.getElementById('modalBody');
            
            let html = `
                <div class="dimension-detail-summary">
                    <div class="detail-score-section">
                        <div class="detail-score">${dimensionData.current_score}分</div>
                        <div class="detail-score-desc">${dimensionData.description}</div>
                    </div>
                </div>
                
                <div class="indicator-grid">
            `;
            
            // 遍历每个指标
            for (const [key, indicator] of Object.entries(dimensionData.key_indicators)) {
                html += `
                    <div class="indicator-item">
                        <div class="indicator-title">
                            <i class="fas fa-chart-bar"></i>
                            ${indicator.name}
                        </div>
                        <div class="indicator-data">
                `;
                
                // 遍历指标的各项数据
                for (const [dataKey, dataValue] of Object.entries(indicator)) {
                    if (dataKey === 'name') continue;
                    
                    const chineseLabel = translateFieldName(dataKey);
                    
                    if (typeof dataValue === 'object' && dataValue !== null) {
                        if (Array.isArray(dataValue)) {
                            if (dataValue.length > 0) {
                                html += `
                                    <div class="data-row">
                                        <span class="data-label">${chineseLabel}</span>
                                        <span class="data-value">${dataValue.join(', ')}</span>
                                    </div>
                                `;
                            }
                        } else {
                            // 对象类型，展开显示
                            for (const [subKey, subValue] of Object.entries(dataValue)) {
                                const chineseSubLabel = translateFieldName(subKey);
                                html += `
                                    <div class="data-row">
                                        <span class="data-label">${chineseLabel} - ${chineseSubLabel}</span>
                                        <span class="data-value ${getValueClass(subValue)}">${formatValue(subValue, subKey)}</span>
                                    </div>
                                `;
                            }
                        }
                    } else {
                        html += `
                            <div class="data-row">
                                <span class="data-label">${chineseLabel}</span>
                                <span class="data-value ${getValueClass(dataValue)}">${formatValue(dataValue, dataKey)}</span>
                            </div>
                        `;
                    }
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            modalBody.innerHTML = html;
        }
        
        function translateFieldName(fieldName) {
            const translations = {
                // ETF相关
                'large_cap_flow': '大盘ETF流向(沪深300等)',
                'large_cap_etf': '大盘ETF(蓝筹股)',
                'small_cap_flow': '小盘ETF流向(中证500等)', 
                'small_cap_etf': '小盘ETF(成长股)',
                'net_inflow': 'ETF净流入',
                'sector_flows': '行业ETF流向',
                
                // 融资融券
                'balance_change': '余额变化',
                'financing_change': '融资变化',
                'securities_lending': '融券变化',
                
                // 成交额
                'level': '热度水平',
                'value': '成交额',
                
                // 涨跌家数
                'up_stocks': '上涨股数',
                'down_stocks': '下跌股数',
                'total_stocks': '总股票数',
                'up_ratio': '上涨比例',
                
                // 北向资金
                'net_inflow_billion': '净流入',
                'shanghai_inflow': '沪股通',
                'shenzhen_inflow': '深股通',
                'significance': '投资含义',
                
                // 板块相关
                'sectors': '板块',
                'count': '数量',
                'current_theme': '当前主题',
                'best_performing': '表现最佳',
                'worst_performing': '表现最差',
                'spread': '分化程度',
                
                // 技术信号
                'indices': '指数',
                'avg_change': '平均变化',
                'breakthrough_score': '突破信号',
                'match_score': '量价配合',
                
                // 情绪指标
                'score': '分数',
                'level': '等级',
                'regime': '环境',
                'status': '状态',
                'signals': '信号',
                
                // 通用
                'unit': '单位',
                'description': '说明',
                'name': '名称'
            };
            
            return translations[fieldName] || fieldName;
        }
        
        function formatValue(value, fieldKey) {
            // 处理null值和undefined值
            if (value === null || value === undefined) {
                if (fieldKey && (fieldKey.includes('flow') || fieldKey.includes('inflow'))) {
                    return '<span class="pending-data">待接入数据源</span>';
                }
                return '<span class="pending-data">暂无数据</span>';
            }
            
            if (typeof value === 'number') {
                let formattedValue;
                if (Number.isInteger(value)) {
                    formattedValue = value.toString();
                } else {
                    formattedValue = value.toFixed(2);
                }
                
                // 根据字段添加合适的单位
                if (fieldKey && fieldKey.includes('ratio') && value <= 1) {
                    return (value * 100).toFixed(1) + '%';
                } else if (fieldKey && (fieldKey.includes('change') || fieldKey.includes('_percent'))) {
                    return formattedValue + '%';
                } else if (fieldKey && (fieldKey.includes('flow') || fieldKey.includes('inflow') || fieldKey.includes('turnover'))) {
                    return formattedValue + '亿元';
                } else if (fieldKey && fieldKey.includes('stocks')) {
                    return formattedValue + '只';
                }
                
                return formattedValue;
            }
            return value;
        }
        
        function getValueClass(value) {
            if (typeof value === 'number') {
                if (value > 0) return 'positive';
                if (value < 0) return 'negative';
            }
            return '';
        }
        
        function closeDimensionDetail() {
            const modal = document.getElementById('dimensionDetailModal');
            modal.style.display = 'none';
            modal.style.opacity = '';
            // 重置请求状态
            window.requestInProgress = false;
            // 清理模态框内容，确保下次打开时重新加载
            document.getElementById('modalBody').innerHTML = '<div class="loading">正在获取详细数据...</div>';
        }
        
        // 点击模态框外部关闭
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('dimensionDetailModal');
            if (e.target === modal) {
                closeDimensionDetail();
            }
        });
        
        // ESC键关闭模态框
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('dimensionDetailModal');
                if (modal.style.display === 'flex') {
                    closeDimensionDetail();
                }
            }
        });

        // 股票项点击事件
        document.addEventListener('click', (e) => {
            if (e.target.closest('.stock-item')) {
                const stockItem = e.target.closest('.stock-item');
                const stockCode = stockItem.querySelector('.stock-code').textContent;
                showNotification(`查看 ${stockCode} 详细分析`, 'info');
            }
        });

        // 机构行为监控相关函数
        function loadInstitutionalData() {
            fetch('http://localhost:5011/api/institutional/overview')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayInstitutionalOverview(data.data);
                    } else {
                        showNotification('机构行为数据获取失败: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('加载机构行为数据失败:', error);
                    showNotification('机构监控服务连接失败', 'error');
                });
        }

        function displayInstitutionalOverview(data) {
            // 更新共识度分数
            document.getElementById('consensusScore').textContent = data.summary.consensus_score || '--';
            document.getElementById('consensusDesc').textContent = data.summary.consensus_desc || '加载中...';
            document.getElementById('mainTrend').textContent = data.summary.main_trend || '正在获取机构动向...';

            // 更新机构卡片数据
            document.getElementById('etfCount').textContent = data.summary.key_signals.etf_rebalancing + '只';
            document.getElementById('etfTrend').textContent = '向大盘蓝筹倾斜';
            
            const flowValue = data.summary.key_signals.northbound_flow;
            const flowColor = flowValue >= 0 ? 'green' : 'red';
            document.getElementById('northboundFlow').innerHTML = 
                `<span style="color: ${flowColor}">${flowValue > 0 ? '+' : ''}${flowValue}亿</span>`;
            document.getElementById('foreignSentiment').textContent = '谨慎观望';
            
            document.getElementById('socialMoves').textContent = data.summary.key_signals.social_security_moves + '只股票';
            document.getElementById('socialFocus').textContent = '消费板块';
            
            document.getElementById('privatePosition').textContent = '72.5%';
            document.getElementById('privateChange').textContent = '+3.2%';

            // 更新板块共识
            if (data.sector_consensus) {
                document.getElementById('bullishSectors').textContent = 
                    data.sector_consensus['强烈看好'] ? data.sector_consensus['强烈看好'].join('、') : '--';
                document.getElementById('neutralSectors').textContent = 
                    data.sector_consensus['保持中性'] ? data.sector_consensus['保持中性'].join('、') : '--';
                document.getElementById('bearishSectors').textContent = 
                    data.sector_consensus['相对谨慎'] ? data.sector_consensus['相对谨慎'].join('、') : '--';
            }
        }

        function refreshInstitutionalData() {
            showNotification('正在刷新机构行为数据...', 'info');
            loadInstitutionalData();
        }

        function showInstitutionalDetail(type) {
            // 防止重复请求
            if (window.requestInProgress) {
                return;
            }
            window.requestInProgress = true;
            
            let apiUrl = '';
            let title = '';
            
            switch(type) {
                case 'etf':
                    apiUrl = 'http://localhost:5011/api/institutional/etf';
                    title = 'ETF调仓详情';
                    break;
                case 'foreign':
                    apiUrl = 'http://localhost:5011/api/institutional/foreign-capital';
                    title = '北向资金详情';
                    break;
                case 'social':
                    apiUrl = 'http://localhost:5011/api/institutional/social-security';
                    title = '社保资金详情';
                    break;
                case 'private':
                    apiUrl = 'http://localhost:5011/api/institutional/private-equity';
                    title = '私募基金详情';
                    break;
            }
            
            if (apiUrl) {
                showNotification(`正在获取${title}...`, 'info');
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        window.requestInProgress = false;
                        if (data.success) {
                            showInstitutionalDetailModal(title, data.data, type);
                        } else {
                            showNotification('获取详情失败: ' + data.error, 'error');
                        }
                    })
                    .catch(error => {
                        window.requestInProgress = false;
                        console.error('获取机构详情失败:', error);
                        showNotification('服务连接失败', 'error');
                    });
            } else {
                window.requestInProgress = false;
            }
        }

        function showInstitutionalDetailModal(title, data, type) {
            let modalContent = '';
            
            switch(type) {
                case 'etf':
                    modalContent = `
                        <div class="detail-section">
                            <h4>ETF市场概览</h4>
                            <div class="market-overview-stats">
                                <div class="stat-item">
                                    <span class="stat-label">全市场ETF总规模</span>
                                    <span class="stat-value">${data.market_overview ? data.market_overview.total_etf_assets : '1.8万亿'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ETF总数量</span>
                                    <span class="stat-value">${data.market_overview ? data.market_overview.tracked_etf_count : '500+只'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">重点跟踪</span>
                                    <span class="stat-value">${data.market_overview ? data.market_overview.monitored_sample : '3只代表性ETF'}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">跟踪样本规模</span>
                                    <span class="stat-value">${data.market_overview ? data.market_overview.sample_assets : '903亿'}</span>
                                </div>
                            </div>
                            <div class="data-explanation">
                                <p><strong>说明:</strong> A股市场有500+只ETF，总规模1.8万亿。我们重点跟踪3只最具代表性的ETF(合计903亿)，涵盖大中小盘主要投资方向。</p>
                            </div>
                            <div class="etf-explanation">
                                <p><strong>大盘ETF:</strong> 跟踪沪深300、上证50等大盘指数，主要投资市值较大的蓝筹股(如贵州茅台、五粮液)</p>
                                <p><strong>小盘ETF:</strong> 跟踪中证500、创业板等中小盘指数，主要投资市值较小的成长股(如宁德时代、爱美客)</p>
                                <p><strong>资金流向意义:</strong> 正值表示资金流入(机构看好)，负值表示资金流出(机构谨慎或调仓)</p>
                            </div>
                        </div>
                        ${data.market_flows ? `
                        <div class="detail-section">
                            <h4>全市场ETF资金流向统计</h4>
                            <div class="flow-stats">
                                <div class="flow-period">
                                    <h5>今日流向</h5>
                                    <div class="flow-data">
                                        <span class="flow-in">流入: +${data.market_flows.today.total_inflow}亿</span>
                                        <span class="flow-out">流出: ${data.market_flows.today.total_outflow}亿</span>
                                        <span class="flow-net ${data.market_flows.today.net_inflow > 0 ? 'positive' : 'negative'}">
                                            净流入: ${data.market_flows.today.net_inflow > 0 ? '+' : ''}${data.market_flows.today.net_inflow}亿
                                        </span>
                                    </div>
                                </div>
                                <div class="flow-period">
                                    <h5>本周累计</h5>
                                    <div class="flow-data">
                                        <span class="flow-in">流入: +${data.market_flows.this_week.total_inflow}亿</span>
                                        <span class="flow-out">流出: ${data.market_flows.this_week.total_outflow}亿</span>
                                        <span class="flow-net positive">净流入: +${data.market_flows.this_week.net_inflow}亿</span>
                                    </div>
                                </div>
                                <div class="flow-period">
                                    <h5>本月累计</h5>
                                    <div class="flow-data">
                                        <span class="flow-in">流入: +${data.market_flows.this_month.total_inflow}亿</span>
                                        <span class="flow-out">流出: ${data.market_flows.this_month.total_outflow}亿</span>
                                        <span class="flow-net positive">净流入: +${data.market_flows.this_month.net_inflow}亿</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="category-flows">
                                <h5>分类资金流向 (今日)</h5>
                                <div class="flow-categories">
                                    ${Object.entries(data.market_flows.category_flows).map(([category, info]) => `
                                        <div class="category-item">
                                            <span class="category-name">${category}</span>
                                            <span class="category-flow ${info.net_flow > 0 ? 'positive' : 'negative'}">
                                                ${info.net_flow > 0 ? '+' : ''}${info.net_flow}亿 (${info.percentage}%)
                                            </span>
                                            <span class="category-trend">${info.trend}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="sector-flows">
                                <div class="hot-sectors">
                                    <h5>🔥 热门板块ETF</h5>
                                    ${data.market_flows.hot_sectors.map(item => `
                                        <div class="sector-item hot">
                                            <span class="sector-name">${item.sector}</span>
                                            <span class="sector-flow positive">+${item.flow}亿</span>
                                            <span class="sector-reason">${item.reason}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="cold-sectors">
                                    <h5>❄️ 流出板块ETF</h5>
                                    ${data.market_flows.cold_sectors.map(item => `
                                        <div class="sector-item cold">
                                            <span class="sector-name">${item.sector}</span>
                                            <span class="sector-flow negative">${item.flow}亿</span>
                                            <span class="sector-reason">${item.reason}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>` : ''}
                        <div class="detail-section">
                            <h4>代表性ETF跟踪</h4>
                            ${data.tracking_etfs.map(etf => `
                                <div class="etf-item">
                                    <h5>${etf.name} (${etf.code})</h5>
                                    <div class="etf-info">
                                        <span class="etf-type">${etf.type || (etf.code.startsWith('510') ? '大盘ETF' : '小盘ETF')} - ${etf.underlying_index || '跟踪相应指数'}</span>
                                        <span class="fund-size">基金规模: ${etf.fund_size || '待查询'}</span>
                                        <span class="next-rebalance">下次调仓: ${etf.next_rebalance}</span>
                                    </div>
                                    <p class="etf-description">${etf.description || '暂无描述'}</p>
                                    <div class="recent-changes">
                                        <h6>最近调仓活动:</h6>
                                        ${etf.recent_changes.map(change => `
                                            <div class="change-item">
                                                <span class="change-date">${change.date}</span>
                                                <span class="change-action ${change.action === '加仓' ? 'positive' : 'negative'}">${change.action}</span>
                                                <span class="change-amount">${change.total_amount}亿元</span>
                                                <span class="change-impact">${change.impact}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="detail-section">
                            <h4>市场趋势分析</h4>
                            <div class="trend-analysis">
                                <div class="trend-item">
                                    <strong>调仓方向:</strong> ${data.key_trends['主要调仓方向']}
                                    <p class="trend-desc">从成长股向价值股转移，说明市场风险偏好下降</p>
                                </div>
                                <div class="trend-item">
                                    <strong>调仓频率:</strong> ${data.key_trends['调仓频率']} 
                                    <p class="trend-desc">季度调仓期通常伴随较大资金流向变化</p>
                                </div>
                                <div class="trend-item">
                                    <strong>资金流向:</strong> ${data.key_trends['资金流向']}
                                    <p class="trend-desc">反映机构对不同市值股票的配置偏好</p>
                                </div>
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>数据源验证</h4>
                            <div class="data-source-info">
                                <button class="verify-btn" onclick="showDataSources()">
                                    <i class="fas fa-search"></i> 查看数据源
                                </button>
                                <button class="compare-btn" onclick="compareDataSources()">
                                    <i class="fas fa-balance-scale"></i> 数据对比
                                </button>
                            </div>
                            <div class="source-quick-info">
                                <p><strong>当前数据源:</strong> 多源聚合(东方财富、新浪财经等)</p>
                                <p><strong>更新频率:</strong> 实时更新</p>
                                <p><strong>验证建议:</strong> 可对比Wind万得、Choice等专业终端数据</p>
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>投资参考</h4>
                            <div class="investment-tips">
                                <ul>
                                    <li>ETF资金流向是机构态度的重要指标</li>
                                    <li>大盘ETF流入通常说明机构偏好稳健</li>
                                    <li>小盘ETF流入表明机构愿意承担更高风险</li>
                                    <li>调仓期间关注主要ETF的申赎情况</li>
                                    <li>建议关注趋势而非绝对数值，多源对比验证</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'foreign':
                    modalContent = `
                        <div class="detail-section">
                            <h4>北向资金流向</h4>
                            <div class="flow-summary">
                                <div class="flow-item">今日净流入: ${data.northbound_capital.today_net_inflow}亿</div>
                                <div class="flow-item">本周累计: ${data.northbound_capital.this_week}亿</div>
                                <div class="flow-item">本月累计: ${data.northbound_capital.this_month}亿</div>
                                <div class="flow-item">年内累计: ${data.northbound_capital.year_to_date}亿</div>
                                <div class="flow-item">投资情绪: ${data.northbound_capital.sentiment}</div>
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>重仓股变动</h4>
                            ${data.top_holdings_changes.map(stock => `
                                <div class="holding-item">
                                    <div class="stock-info">
                                        <span class="stock-name">${stock.stock_name}</span>
                                        <span class="stock-code">${stock.stock_code}</span>
                                    </div>
                                    <div class="holding-change">
                                        <span>持股比例: ${stock.holding_ratio}%</span>
                                        <span class="change-value" style="color: ${stock.change.includes('+') ? 'green' : 'red'}">${stock.change}</span>
                                    </div>
                                    <div class="change-reason">${stock.reason}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'social':
                    modalContent = `
                        <div class="detail-section">
                            <h4>最新持仓变动</h4>
                            ${data.recent_positions.map(position => `
                                <div class="position-item">
                                    <div class="stock-info">
                                        <span class="stock-name">${position.stock_name}</span>
                                        <span class="stock-code">${position.stock_code}</span>
                                    </div>
                                    <div class="position-details">
                                        <span>操作: ${position.action}</span>
                                        <span>持股: ${position.shares}万股</span>
                                        <span>市值: ${position.market_value}亿</span>
                                        <span>排名: 第${position.position_rank}大股东</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="detail-section">
                            <h4>板块配置</h4>
                            <div class="sector-allocation">
                                ${Object.entries(data.sector_allocation).map(([sector, info]) => `
                                    <div class="sector-item">
                                        <span class="sector-name">${sector}</span>
                                        <span class="sector-weight">${info.weight}%</span>
                                        <span class="sector-change" style="color: ${info.change.includes('+') ? 'green' : 'red'}">${info.change}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'private':
                    modalContent = `
                        <div class="detail-section">
                            <h4>仓位变化</h4>
                            <div class="position-summary">
                                <div class="position-item">整体仓位: ${data.position_changes['整体仓位']}%</div>
                                <div class="position-item">仓位变化: ${data.position_changes['仓位变化']}</div>
                                <div class="position-item">股票仓位: ${data.position_changes['股票仓位']}%</div>
                                <div class="position-item">债券仓位: ${data.position_changes['债券仓位']}%</div>
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>策略分布</h4>
                            <div class="strategy-distribution">
                                ${Object.entries(data.strategy_distribution).map(([strategy, percentage]) => `
                                    <div class="strategy-item">
                                        <span class="strategy-name">${strategy}</span>
                                        <span class="strategy-percentage">${percentage}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="detail-section">
                            <h4>业绩领先策略</h4>
                            ${data.performance_leaders.map(leader => `
                                <div class="performance-item">
                                    <span class="strategy-name">${leader.strategy}</span>
                                    <span class="return-rate">${leader.return}%</span>
                                    <span class="reason">${leader.reason}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
            }
            
            // 显示模态框
            const modal = document.getElementById('dimensionDetailModal');
            document.getElementById('modalTitle').innerHTML = `<i class="fas fa-building"></i> ${title}`;
            document.getElementById('modalSubtitle').textContent = '详细数据分析';
            document.getElementById('modalBody').innerHTML = modalContent;
            
            // 确保模态框正确显示
            modal.style.display = 'flex';
        }

        function showConsensusAnalysis() {
            fetch('http://localhost:5011/api/institutional/consensus')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showConsensusModal(data.data);
                    } else {
                        showNotification('获取共识分析失败: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('获取共识分析失败:', error);
                    showNotification('服务连接失败', 'error');
                });
        }

        function showConsensusModal(data) {
            const modalContent = `
                <div class="detail-section">
                    <h4>机构共识水平</h4>
                    <div class="consensus-summary">
                        <div class="consensus-score-large">${data.consensus_level.score}分</div>
                        <div class="consensus-desc">${data.consensus_level.description}</div>
                        <div class="consensus-trend">主要趋势: ${data.consensus_level.trend}</div>
                    </div>
                </div>
                <div class="detail-section">
                    <h4>板块共识</h4>
                    <div class="sector-consensus-detail">
                        ${Object.entries(data.sector_consensus).map(([level, sectors]) => `
                            <div class="consensus-level-item">
                                <h5>${level}</h5>
                                <div class="sectors-list">${sectors.join('、')}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="detail-section">
                    <h4>时机信号</h4>
                    <div class="timing-signals">
                        ${Object.entries(data.timing_signals).map(([signalType, signals]) => `
                            <div class="signal-group">
                                <h5>${signalType}</h5>
                                <ul>
                                    ${signals.map(signal => `<li>${signal}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="detail-section">
                    <h4>投资启示</h4>
                    <div class="investment-implications">
                        ${Object.entries(data.investment_implications).map(([strategy, description]) => `
                            <div class="implication-item">
                                <strong>${strategy}:</strong> ${description}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            const modal = document.getElementById('dimensionDetailModal');
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-users"></i> 机构共识分析';
            document.getElementById('modalSubtitle').textContent = '综合机构行为分析报告';
            document.getElementById('modalBody').innerHTML = modalContent;
            
            // 确保模态框正确显示
            modal.style.display = 'flex';
        }
        
        // 数据源验证功能
        function showDataSources() {
            fetch('http://localhost:5014/api/data-sources/etf')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showDataSourcesModal(data.data);
                    } else {
                        showNotification('获取数据源信息失败: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('获取数据源失败:', error);
                    showNotification('数据源服务连接失败', 'error');
                });
        }
        
        function compareDataSources() {
            fetch('http://localhost:5014/api/data-sources/compare')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showDataComparisonModal(data.data);
                    } else {
                        showNotification('数据对比失败: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('数据对比失败:', error);
                    showNotification('数据对比服务连接失败', 'error');
                });
        }
        
        function showDataSourcesModal(data) {
            const modalContent = `
                <div class="detail-section">
                    <h4>当前数据状态</h4>
                    <div class="current-data">
                        <p><strong>数据源:</strong> ${data.current_data.data_source}</p>
                        <p><strong>更新时间:</strong> ${new Date(data.current_data.timestamp).toLocaleString()}</p>
                        <p><strong>大盘ETF流向:</strong> ${data.current_data.large_cap_flow}亿元</p>
                        <p><strong>小盘ETF流向:</strong> ${data.current_data.small_cap_flow}亿元</p>
                    </div>
                </div>
                <div class="detail-section">
                    <h4>可用数据源</h4>
                    <div class="sources-list">
                        ${data.available_sources.map(source => `
                            <div class="source-item ${source.status.includes('已接入') ? 'connected' : 'not-connected'}">
                                <div class="source-header">
                                    <h6>${source.name}</h6>
                                    <span class="source-status">${source.status}</span>
                                </div>
                                <div class="source-details">
                                    <p><strong>类型:</strong> ${source.type}</p>
                                    <p><strong>覆盖范围:</strong> ${source.coverage}</p>
                                    <p><strong>更新频率:</strong> ${source.update_frequency}</p>
                                    <p><strong>可靠性:</strong> ${source.reliability}</p>
                                    <a href="${source.url}" target="_blank" class="source-link">访问官网 <i class="fas fa-external-link-alt"></i></a>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="detail-section">
                    <h4>验证渠道</h4>
                    <div class="verification-list">
                        ${data.verification_channels.map(channel => `
                            <div class="verification-item">
                                <h6>${channel.name}</h6>
                                <p>${channel.description}</p>
                                <p><strong>验证方法:</strong> ${channel.how_to_verify}</p>
                                <a href="${channel.url}" target="_blank" class="verification-link">前往验证 <i class="fas fa-external-link-alt"></i></a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-database"></i> 数据源详情';
            document.getElementById('modalSubtitle').textContent = 'ETF资金流向数据来源和验证渠道';
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('dimensionDetailModal').style.display = 'flex';
        }
        
        function showDataComparisonModal(data) {
            const modalContent = `
                <div class="detail-section">
                    <h4>多源数据对比</h4>
                    <div class="comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>数据源</th>
                                    <th>大盘ETF(亿元)</th>
                                    <th>小盘ETF(亿元)</th>
                                    <th>净流入(亿元)</th>
                                    <th>更新时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.sources.map(source => `
                                    <tr>
                                        <td>${source.data_source}</td>
                                        <td class="${source.large_cap_flow > 0 ? 'positive' : 'negative'}">${source.large_cap_flow}</td>
                                        <td class="${source.small_cap_flow > 0 ? 'positive' : 'negative'}">${source.small_cap_flow}</td>
                                        <td class="${source.net_inflow_billion > 0 ? 'positive' : 'negative'}">${source.net_inflow_billion}</td>
                                        <td>${new Date(source.timestamp).toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    ${data.comparisons.length > 0 ? `
                    <div class="differences-analysis">
                        <h5>差异分析</h5>
                        ${data.comparisons.map(comp => `
                            <div class="diff-item">
                                <strong>${comp.source}</strong> vs 基准数据:
                                <span>大盘差异: ${comp.differences.large_cap_diff}亿</span>
                                <span>小盘差异: ${comp.differences.small_cap_diff}亿</span>
                                <span>平均偏差: ${comp.differences.avg_deviation}亿</span>
                            </div>
                        `).join('')}
                    </div>` : ''}
                    
                    <div class="reliability-note">
                        <p><strong>可靠性说明:</strong> ${data.reliability_note}</p>
                        <p><strong>使用建议:</strong> ${data.recommendation}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-balance-scale"></i> 数据源对比';
            document.getElementById('modalSubtitle').textContent = '多渠道ETF数据交叉验证';
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('dimensionDetailModal').style.display = 'flex';
        }

        // 市场概览相关函数
        async function loadMarketOverview() {
            console.log('[市场概览] 开始加载数据...');
            try {
                console.log('[市场概览] 发送请求: http://localhost:8526/api/market-stats');
                const response = await fetch('http://localhost:8526/api/market-stats');
                console.log('[市场概览] 响应状态:', response.status, response.statusText);

                const result = await response.json();
                console.log('[市场概览] 响应数据:', result);

                if (result.success) {
                    const data = result.data;
                    document.getElementById('upCount').textContent = data.up_count;
                    document.getElementById('downCount').textContent = data.down_count;
                    document.getElementById('upDownRatio').textContent = data.up_down_ratio.toFixed(2);

                    // 市场情绪判断
                    const ratio = data.up_down_ratio;
                    const sentiment = ratio >= 1.5 ? '强势' :
                                    ratio >= 1.0 ? '偏强' :
                                    ratio >= 0.8 ? '中性' : '偏弱';
                    document.getElementById('marketSentiment').textContent = sentiment;
                    console.log('[市场概览] ✅ 数据加载成功');
                } else {
                    console.error('[市场概览] ❌ API返回失败:', result.error);
                    throw new Error(result.error || '未知错误');
                }
            } catch (error) {
                console.error('[市场概览] ❌ 加载失败:', error);
                console.error('[市场概览] 错误详情:', error.message, error.stack);
                document.getElementById('upCount').textContent = '--';
                document.getElementById('downCount').textContent = '--';
                document.getElementById('upDownRatio').textContent = '--';
                document.getElementById('marketSentiment').textContent = '--';
            }
        }

        async function refreshMarketOverview() {
            showNotification('正在刷新市场概览...');
            await loadMarketOverview();
            showNotification('市场概览已更新');
        }

        // 资金流向相关函数
        async function loadCapitalFlow() {
            console.log('[资金流向] 开始加载数据...');
            try {
                console.log('[资金流向] 发送请求: http://localhost:8526/api/capital-timing');
                const response = await fetch('http://localhost:8526/api/capital-timing');
                console.log('[资金流向] 响应状态:', response.status, response.statusText);

                const result = await response.json();
                console.log('[资金流向] 响应数据:', result);

                if (result.success) {
                    const data = result.data;
                    console.log('[资金流向] 数据详情:', data);

                    // 显示今日流入
                    const todayFlow = data.latest.total_flow || 0;
                    document.getElementById('todayFlow').innerHTML =
                        `<span style="color: ${todayFlow >= 0 ? '#fff' : '#fff'}">
                            ${todayFlow >= 0 ? '+' : ''}${todayFlow.toFixed(2)}亿
                        </span>`;
                    console.log('[资金流向] 今日流入:', todayFlow);

                    // 显示多周期数据
                    const periods = data.periods;
                    if (periods['1d']) {
                        document.getElementById('flow1d').textContent =
                            formatFlow(periods['1d'].net_flow);
                        setPeriodColor('flow1d', periods['1d'].net_flow);
                    }
                    if (periods['3d']) {
                        document.getElementById('flow3d').textContent =
                            formatFlow(periods['3d'].net_flow);
                        setPeriodColor('flow3d', periods['3d'].net_flow);
                    }
                    if (periods['7d']) {
                        document.getElementById('flow7d').textContent =
                            formatFlow(periods['7d'].net_flow);
                        setPeriodColor('flow7d', periods['7d'].net_flow);
                    }
                    if (periods['14d']) {
                        document.getElementById('flow14d').textContent =
                            formatFlow(periods['14d'].net_flow);
                        setPeriodColor('flow14d', periods['14d'].net_flow);
                    }
                    if (periods['28d']) {
                        document.getElementById('flow28d').textContent =
                            formatFlow(periods['28d'].net_flow);
                        setPeriodColor('flow28d', periods['28d'].net_flow);
                    }
                    console.log('[资金流向] ✅ 数据加载成功');
                } else {
                    console.error('[资金流向] ❌ API返回失败:', result.error);
                    throw new Error(result.error || '未知错误');
                }
            } catch (error) {
                console.error('[资金流向] ❌ 加载失败:', error);
                console.error('[资金流向] 错误详情:', error.message, error.stack);
                document.getElementById('todayFlow').textContent = '--';
                ['flow1d', 'flow3d', 'flow7d', 'flow14d', 'flow28d'].forEach(id => {
                    document.getElementById(id).textContent = '--';
                });
            }
        }

        async function refreshCapitalFlow() {
            showNotification('正在刷新资金流向...');
            await loadCapitalFlow();
            showNotification('资金流向已更新');
        }

        // 辅助函数
        function formatFlow(value) {
            return `${value >= 0 ? '+' : ''}${value.toFixed(1)}亿`;
        }

        function setPeriodColor(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('positive', 'negative');
                element.classList.add(value >= 0 ? 'positive' : 'negative');
            }
        }
    </script>

    <!-- 详情模态框 -->
    <div class="detail-modal" id="dimensionDetailModal">
        <div class="detail-modal-content">
            <button class="detail-close-btn" onclick="closeDimensionDetail()">
                <i class="fas fa-times"></i>
            </button>
            <div class="detail-modal-header">
                <h3 class="detail-modal-title" id="modalTitle">
                    <i id="modalIcon" class="fas fa-chart-bar"></i>
                    维度详情
                </h3>
                <p class="detail-modal-subtitle" id="modalSubtitle">正在加载详细数据...</p>
            </div>
            <div class="detail-modal-body" id="modalBody">
                <div class="loading">正在获取详细数据...</div>
            </div>
        </div>
    </div>

</body>
</html>