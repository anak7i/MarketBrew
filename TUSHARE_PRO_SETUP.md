# Tushare Pro 配置指南

## 📋 概述

MarketBrew现已支持Tushare Pro作为数据源，为您提供更稳定、更准确的市场数据：
- **北向资金流向数据**：沪深股通资金流向
- **市场概览数据**：涨跌统计、主要指数数据

## 🔑 获取Tushare Pro Token

### 1. 注册Tushare Pro账号

访问 [Tushare Pro官网](https://tushare.pro/register) 注册账号

### 2. 获取Token

登录后，在个人中心找到您的**API Token**

### 3. 积分要求

- **免费积分**：注册即可获得基础积分
- **北向资金接口**：需要 **120积分**
- **市场概览接口**：需要 **5000积分**（包含daily和daily_basic）

#### 如何获取积分：

- **每日签到**：+1积分/天
- **完善个人信息**：+10积分
- **分享到社交媒体**：+20积分
- **邀请好友注册**：+100积分
- **捐赠支持**：可快速获得大量积分

> 💡 提示：积分不足时，系统会自动回退到东方财富数据源，不影响使用

## ⚙️ 配置方法

### Windows系统

#### 方法1：设置环境变量（推荐）

1. 打开系统属性 → 高级 → 环境变量
2. 在"用户变量"中新建变量：
   - 变量名：`TUSHARE_TOKEN`
   - 变量值：`你的token`
3. 重启命令行窗口或应用

#### 方法2：使用命令行临时设置

```cmd
set TUSHARE_TOKEN=你的token
```

#### 方法3：创建.env文件

在`marketbrew`目录下创建`.env`文件：

```
TUSHARE_TOKEN=你的token
```

### Linux/Mac系统

#### 方法1：设置环境变量（推荐）

编辑 `~/.bashrc` 或 `~/.zshrc`：

```bash
export TUSHARE_TOKEN="你的token"
```

然后执行：
```bash
source ~/.bashrc  # 或 source ~/.zshrc
```

#### 方法2：临时设置

```bash
export TUSHARE_TOKEN=你的token
```

#### 方法3：创建.env文件

同Windows方法3

## 🧪 测试配置

### 1. 测试Tushare Pro服务

```bash
cd C:\Users\86158\marketbrew
python tushare_pro_service.py
```

如果配置正确，应该看到：
```
✅ Tushare Pro服务初始化成功
✅ 成功获取5天北向资金数据
✅ 成功获取市场概况
```

### 2. 测试资金流向服务

```bash
python capital_flow_timing_service.py
```

查看日志，应该看到：
```
✅ 使用Tushare Pro数据源
✅ Tushare Pro获取北向资金XX天历史数据
```

### 3. 测试市场指数服务

```bash
python market_index_service.py
```

启动后访问：http://localhost:5008/api/main-indices

## 📊 数据源说明

### 数据源优先级

系统采用**双重数据源**机制，确保数据稳定性：

1. **优先**：Tushare Pro（如果配置了token且积分足够）
2. **备用**：东方财富API（当Tushare Pro不可用时）

### 优势对比

| 特性 | Tushare Pro | 东方财富API |
|------|------------|-------------|
| 数据准确性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 数据稳定性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 访问速度 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 数据完整性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 限流风险 | 低 | 中 |
| 需要注册 | 是 | 否 |

## 🔍 故障排查

### 问题1：导入错误

**错误信息**：
```
ModuleNotFoundError: No module named 'tushare'
```

**解决方案**：
```bash
pip install tushare
```

### 问题2：Token无效

**错误信息**：
```
❌ 获取北向资金数据失败: auth failed
```

**解决方案**：
1. 检查token是否正确
2. 确认环境变量是否设置成功
3. 重启命令行窗口

### 问题3：积分不足

**日志信息**：
```
⚠️ Tushare Pro返回空数据，尝试使用东方财富...
```

**解决方案**：
- 检查Tushare Pro账号积分
- 系统会自动使用东方财富备用数据源
- 不影响功能使用

### 问题4：系统自动回退到东方财富

**日志信息**：
```
⚠️ Tushare Pro获取失败，回退到东方财富数据源
```

**可能原因**：
1. Token未配置或配置错误
2. 积分不足
3. 网络问题
4. API限流

**系统行为**：
- 自动切换到东方财富数据源
- 继续正常提供数据服务
- 不影响用户使用

## 📈 功能说明

### 北向资金流向

使用Tushare Pro的 `moneyflow_hsgt` 接口，提供：
- 沪股通资金流向
- 深股通资金流向
- 北向资金总流向
- 历史数据（支持自定义天数）

### 市场概览

使用Tushare Pro的多个接口组合：
- `trade_cal`：获取交易日历
- `index_daily`：获取主要指数数据
- `daily`：获取个股涨跌数据
- `daily_basic`：获取市场统计数据

提供：
- 总股票数、涨跌统计
- 涨跌停统计
- 主要指数表现
- 市场情绪判断

## 🚀 使用建议

1. **推荐配置Tushare Pro**
   - 数据更稳定可靠
   - 减少被限流风险
   - 支持更多数据维度

2. **积分获取策略**
   - 每日签到累积
   - 完善个人信息
   - 邀请好友注册
   - 如需快速使用，可考虑捐赠支持

3. **不配置也可以正常使用**
   - 系统会自动使用东方财富数据源
   - 功能完全正常
   - 数据质量也很好

## 📞 技术支持

如有问题，请检查：
1. Token是否正确配置
2. Tushare包是否正确安装
3. 网络连接是否正常
4. 查看日志输出判断具体问题

---

**MarketBrew** - 让投资更智能 💡

版本：2.0 | 更新日期：2025-12-04
