<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•å¸‚åœºæ•°æ®æ˜¾ç¤º</title>
</head>
<body>
    <h1>æµ‹è¯•å¸‚åœºæ•°æ®æ˜¾ç¤º</h1>
    <div id="marketData"></div>
    <div id="formattedData"></div>
    
    <script>
        // æ ¼å¼åŒ–å¸‚åœºåˆ†ææ–‡æœ¬
        function formatMarketAnalysis(marketContext) {
            if (!marketContext) return '';
            
            // è§£æå¸‚åœºç¯å¢ƒæ•°æ®
            const lines = marketContext.split('\n');
            let formattedText = '';
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                if (line.startsWith('å¸‚åœºç¯å¢ƒ:')) {
                    return; // è·³è¿‡æ ‡é¢˜
                } else if (line.startsWith('å¤§ç›˜:')) {
                    const content = line.replace('å¤§ç›˜:', '').trim();
                    formattedText += `<strong>ğŸ“ˆ å¤§ç›˜èµ°åŠ¿ï¼š</strong>${content}<br><br>`;
                } else if (line.startsWith('æŒ‡æ•°:')) {
                    const content = line.replace('æŒ‡æ•°:', '').trim();
                    formattedText += `<strong>ğŸ“Š ä¸»è¦æŒ‡æ•°ï¼š</strong>${content}<br><br>`;
                } else if (line.startsWith('æ¶¨è·Œ:')) {
                    const content = line.replace('æ¶¨è·Œ:', '').trim();
                    formattedText += `<strong>ğŸ“¶ æ¶¨è·Œåˆ†å¸ƒï¼š</strong>${content}<br><br>`;
                } else if (line.startsWith('æƒ…ç»ª:')) {
                    const content = line.replace('æƒ…ç»ª:', '').trim();
                    formattedText += `<strong>ğŸ’­ å¸‚åœºæƒ…ç»ªï¼š</strong>${content}`;
                } else if (line.startsWith('æ¢æ‰‹:')) {
                    const content = line.replace('æ¢æ‰‹:', '').trim();
                    formattedText += ` | <strong>ğŸ”„ æ¢æ‰‹ç‡ï¼š</strong>${content}`;
                } else if (line.startsWith('çƒ­ç‚¹:')) {
                    const content = line.replace('çƒ­ç‚¹:', '').trim();
                    let hotspots = content;
                    try {
                        const parsed = JSON.parse(content);
                        if (Array.isArray(parsed)) {
                            hotspots = parsed.join('ã€');
                        }
                    } catch (e) {
                        // å¦‚æœä¸æ˜¯JSONæ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨åŸæ–‡æœ¬
                    }
                    formattedText += `<br><br><strong>ğŸ”¥ çƒ­ç‚¹æ¿å—ï¼š</strong>${hotspots}`;
                }
            });
            
            return formattedText || marketContext.replace(/\n/g, '<br>');
        }

        // æµ‹è¯•APIè°ƒç”¨
        fetch('http://localhost:8526/api/decisions')
        .then(response => response.json())
        .then(data => {
            console.log('APIè¿”å›æ•°æ®:', data);
            document.getElementById('marketData').innerHTML = `
                <h2>åŸå§‹å¸‚åœºæ•°æ®:</h2>
                <pre>${JSON.stringify(data.market_context, null, 2)}</pre>
            `;
            
            if (data.market_context) {
                const formatted = formatMarketAnalysis(data.market_context);
                document.getElementById('formattedData').innerHTML = `
                    <h2>æ ¼å¼åŒ–åçš„å¸‚åœºæ•°æ®:</h2>
                    <div style="border: 1px solid #ccc; padding: 15px; background: #f9f9f9;">
                        ${formatted}
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('APIè°ƒç”¨å¤±è´¥:', error);
            document.getElementById('marketData').innerHTML = '<p style="color: red;">APIè°ƒç”¨å¤±è´¥: ' + error.message + '</p>';
        });
    </script>
</body>
</html>