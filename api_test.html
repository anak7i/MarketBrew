<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .test-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª API ç«¯ç‚¹æµ‹è¯•å·¥å…·</h1>

        <div class="summary">
            <h2 style="margin-bottom: 15px;">æµ‹è¯•æ‘˜è¦</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">æœåŠ¡åœ°å€</div>
                    <div class="summary-value" style="font-size: 16px;">localhost:8526</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æµ‹è¯•é€šè¿‡</div>
                    <div class="summary-value" id="passCount">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">æµ‹è¯•å¤±è´¥</div>
                    <div class="summary-value" id="failCount" style="color: #dc3545;">0</div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•1: å¸‚åœºç»Ÿè®¡ -->
        <div class="test-card">
            <div class="test-header">
                <div>
                    <span class="test-title">1ï¸âƒ£ å¸‚åœºç»Ÿè®¡ API</span>
                    <span class="status loading" id="status1">æœªæµ‹è¯•</span>
                </div>
                <button class="test-btn" onclick="testMarketStats()">è¿è¡Œæµ‹è¯•</button>
            </div>
            <div class="result-box" id="result1">ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®å¼€å§‹...</div>
        </div>

        <!-- æµ‹è¯•2: èµ„é‡‘æµå‘ -->
        <div class="test-card">
            <div class="test-header">
                <div>
                    <span class="test-title">2ï¸âƒ£ èµ„é‡‘æµå‘ API</span>
                    <span class="status loading" id="status2">æœªæµ‹è¯•</span>
                </div>
                <button class="test-btn" onclick="testCapitalTiming()">è¿è¡Œæµ‹è¯•</button>
            </div>
            <div class="result-box" id="result2">ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®å¼€å§‹...</div>
        </div>

        <!-- æµ‹è¯•3: æœåŠ¡è¯Šæ–­ -->
        <div class="test-card">
            <div class="test-header">
                <div>
                    <span class="test-title">3ï¸âƒ£ æœåŠ¡è¯Šæ–­ç«¯ç‚¹</span>
                    <span class="status loading" id="status3">æœªæµ‹è¯•</span>
                </div>
                <button class="test-btn" onclick="testCapitalService()">è¿è¡Œæµ‹è¯•</button>
            </div>
            <div class="result-box" id="result3">ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®å¼€å§‹...</div>
        </div>

        <!-- ä¸€é”®æµ‹è¯•æ‰€æœ‰ -->
        <div style="text-align: center; margin-top: 30px;">
            <button class="test-btn" onclick="testAll()" style="padding: 15px 40px; font-size: 16px;">
                ğŸš€ ä¸€é”®æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
            </button>
        </div>
    </div>

    <script>
        let passCount = 0;
        let failCount = 0;

        function updateSummary() {
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
        }

        function updateStatus(id, success, message = '') {
            const statusEl = document.getElementById(`status${id}`);
            if (success) {
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… é€šè¿‡';
                passCount++;
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ å¤±è´¥';
                failCount++;
            }
            updateSummary();
        }

        async function testMarketStats() {
            const resultBox = document.getElementById('result1');
            const statusBox = document.getElementById('status1');

            statusBox.className = 'status loading';
            statusBox.textContent = 'â³ æµ‹è¯•ä¸­...';
            resultBox.textContent = 'æ­£åœ¨æµ‹è¯•å¸‚åœºç»Ÿè®¡ API...\n';

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:8526/api/market-stats');
                const endTime = Date.now();

                resultBox.textContent += `å“åº”æ—¶é—´: ${endTime - startTime}ms\n`;
                resultBox.textContent += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n\n`;

                const data = await response.json();
                resultBox.textContent += `å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}\n\n`;

                if (data.success) {
                    resultBox.textContent += `âœ… æµ‹è¯•é€šè¿‡\n`;
                    resultBox.textContent += `ä¸Šæ¶¨å®¶æ•°: ${data.data.up_count}\n`;
                    resultBox.textContent += `ä¸‹è·Œå®¶æ•°: ${data.data.down_count}\n`;
                    resultBox.textContent += `æ¶¨è·Œæ¯”: ${data.data.up_down_ratio}\n`;
                    updateStatus(1, true);
                } else {
                    resultBox.textContent += `âŒ APIè¿”å›å¤±è´¥: ${data.error}\n`;
                    updateStatus(1, false);
                }
            } catch (error) {
                resultBox.textContent += `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}\n`;
                resultBox.textContent += `\næç¤º: è¯·ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œåœ¨ http://localhost:8526\n`;
                updateStatus(1, false);
            }
        }

        async function testCapitalTiming() {
            const resultBox = document.getElementById('result2');
            const statusBox = document.getElementById('status2');

            statusBox.className = 'status loading';
            statusBox.textContent = 'â³ æµ‹è¯•ä¸­...';
            resultBox.textContent = 'æ­£åœ¨æµ‹è¯•èµ„é‡‘æµå‘ API...\n';

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:8526/api/capital-timing');
                const endTime = Date.now();

                resultBox.textContent += `å“åº”æ—¶é—´: ${endTime - startTime}ms\n`;
                resultBox.textContent += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n\n`;

                const data = await response.json();

                if (data.success) {
                    resultBox.textContent += `âœ… æµ‹è¯•é€šè¿‡\n\n`;
                    resultBox.textContent += `ä»Šæ—¥æµå…¥: ${data.data.latest.total_flow || 0} äº¿\n`;
                    resultBox.textContent += `å¤šå‘¨æœŸæ•°æ®:\n`;

                    const periods = data.data.periods;
                    for (const [period, stats] of Object.entries(periods)) {
                        resultBox.textContent += `  ${period}: ${stats.net_flow > 0 ? '+' : ''}${stats.net_flow.toFixed(1)} äº¿\n`;
                    }

                    resultBox.textContent += `\nå®Œæ•´å“åº”:\n${JSON.stringify(data, null, 2)}\n`;
                    updateStatus(2, true);
                } else {
                    resultBox.textContent += `âŒ APIè¿”å›å¤±è´¥: ${data.error}\n`;
                    resultBox.textContent += `\nå®Œæ•´å“åº”:\n${JSON.stringify(data, null, 2)}\n`;
                    updateStatus(2, false);
                }
            } catch (error) {
                resultBox.textContent += `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}\n`;
                resultBox.textContent += `\næç¤º: è¯·ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œåœ¨ http://localhost:8526\n`;
                updateStatus(2, false);
            }
        }

        async function testCapitalService() {
            const resultBox = document.getElementById('result3');
            const statusBox = document.getElementById('status3');

            statusBox.className = 'status loading';
            statusBox.textContent = 'â³ æµ‹è¯•ä¸­...';
            resultBox.textContent = 'æ­£åœ¨æµ‹è¯•æœåŠ¡è¯Šæ–­ç«¯ç‚¹...\n';

            try {
                const startTime = Date.now();
                const response = await fetch('http://localhost:8526/api/test-capital');
                const endTime = Date.now();

                resultBox.textContent += `å“åº”æ—¶é—´: ${endTime - startTime}ms\n`;
                resultBox.textContent += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n\n`;

                const data = await response.json();
                resultBox.textContent += `å®Œæ•´å“åº”:\n${JSON.stringify(data, null, 2)}\n\n`;

                if (data.success) {
                    const testResult = data.test_result;
                    resultBox.textContent += `âœ… è¯Šæ–­æµ‹è¯•é€šè¿‡\n\n`;
                    resultBox.textContent += `æœåŠ¡å®ä¾‹å­˜åœ¨: ${testResult.service_exists ? 'æ˜¯' : 'å¦'}\n`;
                    resultBox.textContent += `æœåŠ¡ç±»å‹: ${testResult.service_type || 'N/A'}\n`;
                    if (testResult.north_data_count !== undefined) {
                        resultBox.textContent += `åŒ—å‘æ•°æ®æ¡æ•°: ${testResult.north_data_count}\n`;
                    }
                    if (testResult.north_data_error) {
                        resultBox.textContent += `âš ï¸ æ•°æ®è·å–é”™è¯¯: ${testResult.north_data_error}\n`;
                    }
                    updateStatus(3, true);
                } else {
                    resultBox.textContent += `âŒ è¯Šæ–­æµ‹è¯•å¤±è´¥: ${data.error}\n`;
                    updateStatus(3, false);
                }
            } catch (error) {
                resultBox.textContent += `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}\n`;
                resultBox.textContent += `\næç¤º: è¯·ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œåœ¨ http://localhost:8526\n`;
                updateStatus(3, false);
            }
        }

        async function testAll() {
            passCount = 0;
            failCount = 0;
            updateSummary();

            await testMarketStats();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testCapitalTiming();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testCapitalService();

            alert(`æµ‹è¯•å®Œæˆï¼\né€šè¿‡: ${passCount}\nå¤±è´¥: ${failCount}`);
        }
    </script>
</body>
</html>
