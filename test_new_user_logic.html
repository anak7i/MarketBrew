<!DOCTYPE html>
<html>
<head>
    <title>New User Logic Test</title>
</head>
<body>
    <h1>New User Subscription Logic Test</h1>
    <div id="results"></div>
    
    <script>
        function testNewUserLogic() {
            const results = [];
            
            // Test 1: Logged in user should get empty array
            localStorage.setItem('marketbrew_token', 'test_token');
            localStorage.removeItem('stockSubscriptions');
            
            function loadSubscriptions() {
                try {
                    const saved = localStorage.getItem('stockSubscriptions');
                    if (saved) {
                        const data = JSON.parse(saved);
                        console.log(`âœ… åŠ è½½äº† ${data.length} ä¸ªè®¢é˜…`);
                        return data;
                    }
                } catch (e) {
                    console.error('âš ï¸ åŠ è½½è®¢é˜…æ•°æ®å¤±è´¥:', e);
                }
                
                const isLoggedIn = localStorage.getItem('marketbrew_token');
                
                // å¦‚æžœç”¨æˆ·å·²ç™»å½•ï¼Œæ°¸è¿œä¸åŠ è½½é»˜è®¤è‚¡ç¥¨ï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰æ‹©
                if (isLoggedIn) {
                    console.log('ðŸ†• ç™»å½•ç”¨æˆ·ï¼Œä»Žç©ºè®¢é˜…å¼€å§‹');
                    return [];
                }
                
                // ä»…å¯¹æœªç™»å½•çš„æ¸¸å®¢æä¾›ç¤ºä¾‹è‚¡ç¥¨
                const isFirstVisit = !localStorage.getItem('marketbrew_visited');
                if (!isFirstVisit) {
                    localStorage.setItem('marketbrew_visited', 'true');
                    return [
                        {symbol: '000001', name: 'å¹³å®‰é“¶è¡Œ', addedAt: new Date().toISOString()},
                        {symbol: '600519', name: 'è´µå·žèŒ…å°', addedAt: new Date().toISOString()}
                    ];
                }
                
                return [];
            }
            
            const result1 = loadSubscriptions();
            results.push(`Test 1 - Logged in user: ${result1.length} subscriptions (expected: 0)`);
            
            // Test 2: Not logged in user should get default stocks
            localStorage.removeItem('marketbrew_token');
            localStorage.removeItem('marketbrew_visited');
            
            const result2 = loadSubscriptions();
            results.push(`Test 2 - Not logged in user: ${result2.length} subscriptions (expected: 2)`);
            
            // Display results
            document.getElementById('results').innerHTML = results.map(r => `<p>${r}</p>`).join('');
            
            // Clean up
            localStorage.removeItem('marketbrew_token');
            localStorage.removeItem('stockSubscriptions');
            localStorage.removeItem('marketbrew_visited');
        }
        
        testNewUserLogic();
    </script>
</body>
</html>